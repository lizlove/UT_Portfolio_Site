YUI.add("layout-engine",function(e){"use strict";var t,n,r,i,s=e.flutil,o,u,a;u={debug:!1,displayCollectionListSelector:'[data-layout-element="displayCollection"]'},a={},o=s.getLogger(u.debug),t=function(){e.SimpleEventEmitter.apply(this),this.payload=[],this._style={},this._el={},this.options={}},t.prototype=s.objectCreate(e.SimpleEventEmitter.prototype,{init:function(e){e||(e=this.options),this.container=e.container,this.template=e.template,this.templatePartial=e.templatePartial},renderFragment:function(e){if(!e||!e.length)return this.renderFragmentWrappers([]);var t=this,n,r,i=e.length;n=function(n){if(--i)return;t.renderFragmentWrappers(e)},r=function(e){var t=e.view||e;YUI.Env.isServer||(t.updateDom(),t.activate()),n()},e.forEach(function(e){var t=e.displayItem;if(t.is("rendered"))return r(t);t.once("rendered",r),t.initialize()})},renderFragmentWrappers:function(e){var t=this,i,s,o,a,f,l;this.container.hasChildNodes()||(f=(YUI.Env.isServer?e:e.slice(0,1)).map(function(e){return e.toTemplateJSON()}),o={displayWrappers:f,layout:{styles:this.stylesToJSON()}},this.resetStyles(),i=this.template(o),this.container.setHTML(i),YUI.Env.isServer||(a=this.container.one(u.displayCollectionListSelector),a&&a.setHTML(""))),YUI.Env.isServer||(s=new n,e.forEach(function(e){var n;e.isRendered?e.updateDom():(n=new r,n.render(t.templatePartial,e.toTemplateJSON()),e.setContainer(n.get("firstChild")),s.appendChild(e.container))}),this.updateDom(),s.numNodes()&&(l=this.container.one(u.displayCollectionListSelector),l.appendChild(s.getNode()))),this.fire("rendered")},setStyles:function(e,t){this._style[e]||(this._style[e]={}),s.extend(this._style[e],t)},stylesToJSON:function(){var e=this;return Object.keys(this._style).reduce(function(t,n){var r=e._style[n];return t[n]=Object.keys(r).reduce(function(e,t){return e+t+":"+r[t]+";"},""),t},{})},updateDom:function(){if(YUI.Env.isServer)return;var e=this,t=this.container||this.get("container");Object.keys(this._style).forEach(function(n){var r=e._el[n];r||(e._el[n]=r=t.getDOMNode().getAttribute("data-layout-element")===n?t:t.one('[data-layout-element="'+n+'"]'));if(!r)return;r.setStyles(e._style[n])}),this.resetStyles()},resetStyles:function(){this._style={}},render:function(){console.warn("layout-engine::render() is a no-op. Implement on a subclass if needed.")},append:function(){console.warn("layout-engine::append() is a no-op. Implement on a subclass if needed.")},remove:function(){console.warn("layout-engine::remove() is a no-op. Implement on a subclass if needed.")},scrollTo:function(){console.warn("layout-engine::scrollTo() is a no-op. Implement on a subclass if needed.")},destroy:function(){this.options=null,this.container.detach(),this.container=null,this._el=null,this._style=null,e.SimpleEventEmitter.prototype.destroy.apply(this)}}),i=t.DisplayWrapper=function(e){this.layout=null,this.container=null,this.displayItem=e,this._style={},this._el={},this.isRendered=!1},i.prototype={setContainer:function(e){this.container=e;var t=this.container.one(".view");t&&this.displayItem.acquireContainer(t),this.isRendered=!0},bindLayout:function(e){this.layout=e},hasLayout:function(){return!!this.layout},setStyles:function(e,t){this._style[e]||(this._style[e]={}),s.extend(this._style[e],t)},position:function(e,t){this.setStyles("displayWrapper",{top:e+"px",left:t+"px"}),this.displayItem.fire("position",{top:e||null,left:t||null})},resetStyles:function(){this._style={}},updateDom:function(){if(YUI.Env.isServer)return;var e=this,t=this.container;Object.keys(this._style).forEach(function(n){var r=e._el[n];r||(e._el[n]=r=t.getDOMNode().getAttribute("data-layout-element")===n?t:t.one('[data-layout-element="'+n+'"]'));if(!r)return;r.setStyles(e._style[n])}),this.resetStyles()},getId:function(){return"DW"+this.displayItem.photo.id},toStylesJSON:function(){var e=this;return Object.keys(this._style).reduce(function(t,n){var r=e._style[n];return t[n]=Object.keys(r).reduce(function(e,t){return e+t+":"+r[t]+";"},""),t},{})},toTemplateJSON:function(){return{layout:{styles:this.toStylesJSON()},displayItem:this.displayItem,id:this.getId()}},destroy:function(){}},n=t.DocumentFragment=function(){this.init()},n.prototype=YUI.Env.isServer?{init:function(){this.html=""},appendChild:function(e){this.html+=e.html},getNode:function(){return this}}:{init:function(e){this._nodes=0,this._fragment=document.createDocumentFragment()},appendChild:function(e){this._nodes++,this._fragment.appendChild(e.getDOMNode())},getNode:function(){return this._fragment},numNodes:function(){return this._nodes}},r=t.DocumentElement=function(){this.init()},r.prototype=YUI.Env.isServer?{init:function(){this.html=""},render:function(e,t){this.setHTML(e(t))},setHTML:function(e){this.html=e},get:function(e){if(e==="firstChild")return this},getDOMNode:function(){return null}}:{init:function(){this.el=document.createElement("div")},setHTML:function(e){this.el.innerHTML=e},render:function(e,t){this.setHTML(e(t));var n=Object.keys(t).reduce(function(e,n){return t[n].render&&(e[t[n].getId()]=t[n].get("container").getDOMNode()),e},{});Array.prototype.slice.call(this.el.getElementsByClassName("hb-placeholder")).forEach(function(e){e.parentNode.replaceChild(n[e.id],e)})},get:function(t){if(t==="firstChild")return e.one(this.el.firstChild)},getDOMNode:function(){return this.el}},e.LayoutEngine=t},"@VERSION@",{requires:["flutil","flickr-promise","simple-event-emitter"]});
YUI.add("layout-engine-justified-row",function(e){"use strict";var t,n=e.flutil,r,i;i={debug:!1,sizeBreakPoint:1500,sizeBump:1.3},r=n.getLogger(i.debug),t=function(t){e.SimpleEventEmitter.apply(this),this.payload=[],this.layoutEngine=null,this.rowIndex=null,this.options=n.extend({vertPadding:5,horizPadding:5,targetHeight:299,targetHeightTolerance:.29,width:"auto",layoutEngine:{}},t),this._targetRange={},this.init()},t.prototype=n.objectCreate(e.SimpleEventEmitter.prototype,{init:function(e){e||(e=this.options),this.height=0,this.displayWidth=this.availableWidth=typeof e.width=="number"?e.width:800,this.width=0,this.overflow=0,this.offsetTop=0},bindLayout:function(e){this.layoutEngine=e.layoutEngine,this.rowIndex=e.rowIndex},addItem:function(e){var t,n=this.getTargetAreaSize();this.payload.push(e);if(this.getScaledWidth()>this.displayWidth&&this.payload.length>1){t=this.getScaledHeight();if(t<n.minHeight||t>n.maxHeight){this.payload.pop(),e.bindLayout(null);return}}e.bindLayout({row:this})},end:function(){var e;e=this.getScaledWidth(this.targetHeight),this.displayWidth=Math.min(e,this.availableWidth)},clear:function(){this.displayWidth=this.availableWidth,this.payload.forEach(function(e){e.bindLayout(null)});var e=this.payload;return this.payload=[],e},getTargetAreaSize:function(){if(this._targetRange._displayWidth===this.displayWidth)return this._targetRange;var e=this.displayWidth>i.sizeBreakPoint?this.options.targetHeight*i.sizeBump:this.options.targetHeight,t=Math.floor(e*(1-this.options.targetHeightTolerance)),n=Math.ceil(e*(1+this.options.targetHeightTolerance));return this._targetRange={_displayWidth:this.displayWidth,targetHeight:e,minHeight:t,maxHeight:n}},computeLayout:function(){var e=this.getTargetAreaSize();return this.height=this.getScaledHeight(),this.height<e.minHeight?this.height=e.minHeight:this.height>e.maxHeight&&(this.height=e.maxHeight),this.width=this.getScaledWidth(this.height),this.overflow=this.width-this.displayWidth,this.offsetTop=this.layoutEngine.getRowStackHeight(this.rowIndex-1)+this.rowIndex*this.options.vertPadding,!0},getAspectRatio:function(){return this.payload.reduce(function(e,t){return e+t.displayItem.assetManager.getAspectRatio()},0)},getScaledWidth:function(e,t){var n;return e||(e=this.getTargetAreaSize().targetHeight),t=t===undefined?this.options.horizPadding:t|0,n=this.getAspectRatio()*e+t*(this.payload.length-1),Math.ceil(n)},getScaledHeight:function(){var e,t;return t=this.getAspectRatio(),e=this.displayWidth-(this.payload.length-1)*this.options.horizPadding,Math.ceil(1/t*e)},render:function(){var e=this,t,n,i;t=this.computeLayout();if(!t){r.log("JustifiedRow.computeLayout found no solution");return}n=this.overflow/this.payload.length|0,i=0,this.payload.forEach(function(t){var r=t.displayItem,s,o;t.position(e.offsetTop,i),o=i===0?e.overflow-n*(e.payload.length-1):n,s=r.assetManager.getScaledWidth(e.height)-o,r.resize(s,e.height),i+=r.frameWidth+e.options.horizPadding})},getWrappers:function(){return this.payload||[]},destroy:function(){this.payload.forEach(function(e){e.bindLayout(null)}),this.payload=null,this.options=null,this.layoutEngine=null,e.SimpleEventEmitter.prototype.destroy.apply(this)}}),e.LayoutEngineJustifiedRow=t},"@VERSION@",{requires:["flutil","flickr-promise","simple-event-emitter"]});
YUI.add("hermes-template-display-collection-justified-item",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="ui-display-wrapper ui-display-wrapper-justified" id="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-layout-element="displayWrapper" style="'+f((o=(o=(o=t.layout,o==null||o===!1?o:o.styles),o==null||o===!1?o:o.displayWrapper),typeof o===a?o.apply(t):o))+'">\n	',u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t.displayItem,u):l.call(t,"outlet",t.displayItem,u)))+"\n</div>\n\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/display-collection-justified-item",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-display-collection-justified",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i;r+="\n		",i=n.each.call(e,e.displayWrappers,{hash:{},inverse:a.noop,fn:a.program(2,h,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function h(e,t){var i="",s;i+="\n			",s=a.invokePartial(r["display-collection-justified-item"],"display-collection-justified-item",e,n,r,t);if(s||s===0)i+=s;return i+="\n		",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u,a=this,f="function",l=this.escapeExpression;s+='<section data-layout-element="displayCollection" style="'+l((o=(o=(o=t.layout,o==null||o===!1?o:o.styles),o==null||o===!1?o:o.displayCollection),typeof o===f?o.apply(t):o))+"\">\n	<script>\n		//getting the cookie with no library\n		var liqpw = (document.cookie.match(/liqpw\\s*=\\s*(\\d+)/) || [])[1] || 0;\n\n		//if cookie width is incorrect!\n		if (window.innerWidth != liqpw) {\n			document.body && document.body.classList.add('ui-state-wrong-cookie-width');\n		}\n	</script>\n	",u=n["if"].call(t,t.displayWrappers,{hash:{},inverse:a.noop,fn:a.program(1,c,i),data:i});if(u||u===0)s+=u;return s+="\n</section>\n",s}),r={};e.Array.each(["display-collection-justified-item"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/display-collection-justified",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-display-collection-justified-item"]});
YUI.add("layout-engine-justified",function(e){"use strict";var t,n=e.LayoutEngine.DisplayWrapper,r=e.flutil,i,s=typeof window!="undefined"?window:{},o,u;o={debug:!1,vertPadding:8,horizPadding:8,bottomPadding:8,targetHeight:320,targetHeightTolerance:.25,maxHorizOverflow:5,gutterWidth:0,autoGutterToContentWidth:!1,bufferTop:3,bufferBottom:3},u={unWrapDisplayItem:function(e){return e.displayItem}},i=r.getLogger(o.debug),t=function(t){this.rows=[],this.currentRow=null,e.LayoutEngine.apply(this),this.options=r.extend({vertPadding:o.vertPadding,horizPadding:o.horizPadding,bottomPadding:o.bottomPadding,targetHeight:o.targetHeight,gutterWidth:o.gutterWidth,autoGutterToContentWidth:o.autoGutterToContentWidth,targetHeightTolerance:o.targetHeightTolerance,viewport:null,container:null,monitorViewport:!0,scrolling:!0,template:r.getTemplate("display-collection-justified"),templatePartial:r.getTemplate("display-collection-justified-item")},t),this.init()},t.prototype=r.objectCreate(e.LayoutEngine.prototype,{init:function(e){e||(e=this.options),this.container=e.container,this.template=e.template,this.templatePartial=e.templatePartial,this.viewport=r.extend({width:800,height:600,scrollbarWidth:16},e.viewport),this.assignEventHandlers()},assignEventHandlers:function(){var t=this,n=this.container,i=0,o,u;!YUI.Env.isServer&&this.options.monitorViewport&&(t.options.singleRow||(o=function(){r.setCookie({remove:!0,cookieName:"liqpw",path:"/",cookieValue:t.viewport.width+t.options.gutterWidth*2}),r.setCookie({remove:!0,cookieName:"liqph",path:"/",cookieValue:t.viewport.height})},o()),u=function(){var e,r=100,i=Math.floor(t.options.targetHeight/2),o=Math.abs;t._scroll=e={timer:null,offsetY:0,offsetVisibilityY:0,offsetTop:n.getY(),state:"still",shield:document.createElement("div"),shieldState:!1},e.shield.classList.add("ui-display-scrollshield"),document.body.appendChild(e.shield),e.timer=setInterval(function(){var n=s.pageYOffset;n===e.offsetY?(e.state!=="still"&&t.fire("scrollStop"),e.state="still",e.shieldState&&(e.shield.style.display="none"),e.shieldState=!1):(window.paftTiming&&(window.paftTiming=null),e.state="scroll",o(n-e.offsetY)<r?(e.shieldState&&(e.shield.style.display="none"),e.shieldState=!1):(e.shieldState||(e.shield.style.display="block"),e.shieldState=!0)),e.offsetY=n,o(n-e.offsetVisibilityY)>i&&(e.offsetVisibilityY=n,t.computeVisible())},250)},this.options.scrolling&&u(),e.use("global-events",function(e){t._resize={},t._resize.handler=e.globalEvents.subscribe("window:resize",function(e){clearTimeout(i),i=setTimeout(function(){t.options.singleRow?t.fire("resize",function(e,n){t.viewport.width=e,t.viewport.height=n,t.reflow()}):(t.options.autoGutterToContentWidth&&(t.options.gutterWidth=(s.innerWidth-t.options.autoGutterToContentWidth)/2),t.viewport.width=s.innerWidth-t.options.gutterWidth*2,t.viewport.height=s.innerHeight,o(),t.reflow())},150)})}))},computeVisible:function(){var e,t=[],n=[],r=[],i,a,f,l,c,h,p=this.rows.length,d,v,m,g;e=this._scroll?this._scroll.offsetY:s.pageYOffset,f=this.viewport.height*o.bufferTop,l=this.viewport.height*o.bufferBottom,c=e-f-this.options.targetHeight,h=e+this.viewport.height+l,i=e-this.options.targetHeight/2|0,a=e+this.viewport.height,d=this._scroll?this._scroll.offsetTop:this.container.getY(),this._bottom||(this._bottom=1);for(g=0;g<p;g++)v=this.rows[g],m=v.offsetTop+d,m>i&&m<a&&(r=r.concat(v.payload)),m<c?n=n.concat(v.payload):m>c&&m<h?(t=t.concat(v.payload),g===p-1&&g>this._bottom&&(this._bottom=g,this.fire("bottom",{row:this.rows[g]}))):m>h&&(n=n.concat(v.payload));this.fire("visibilitychanged",{viewsVisible:r.map(u.unWrapDisplayItem),viewsIn:t.map(u.unWrapDisplayItem),viewsOut:n.map(u.unWrapDisplayItem)})},scrollTo:function(t,n){var r,i,s;n=(n||0)-o.vertPadding;if(typeof t=="string"){for(r=0,i=this.payload.length;r<i;r++)if(this.payload[r].displayItem.photo.id===t){t=this.payload[r];break}}else if(!t.layout)for(r=0,i=this.payload.length;r<i;r++)if(this.payload[r].displayItem===t){t=this.payload[r];break}if(!t)return;s=function(){if(!s.ttl)return;if(s.view.container){var t=s.view.container.getDOMNode();t.scrollIntoView&&t.scrollIntoView(),n&&e.config.win.scrollBy(0,n);return}s.ttl--,setTimeout(s,10)},s.ttl=300,s.view=t,s()},addRow:function(){var t,n,r;t=this.rows.length,r=this.viewport.width-2*this.options.horizPadding-this.viewport.scrollbarWidth,n={vertPadding:this.options.vertPadding,horizPadding:this.options.horizPadding,targetHeight:this.options.targetHeight,targetHeightTolerance:this.options.targetHeightTolerance,width:r},this.currentRow=new e.LayoutEngineJustifiedRow(n),this.currentRow.bindLayout({layoutEngine:this,rowIndex:t}),this.rows.push(this.currentRow)},getRowStackHeight:function(e){var t=e===undefined?this.rows.length:e+1,n=0,r;for(r=0;r<t;r++)n+=this.rows[r].height||this.rows[r].options.targetHeight;return n},append:function(e){if(!Array.isArray(e))return;var t,r={};this.container.all(".ui-display-wrapper").each(function(e){r[e.get("id")]=e}),t=e.map(function(e){var t=new n(e),i=r[t.getId()];return i&&t.setContainer(i),t}),this.payload=this.payload.concat(t),this.render(this.currentRow)},remove:function(e){e.forEach(function(e){e.remove()})},render:function(e){var t=this,n,r,i,s,o,u,a=[];if(!this.payload.length){this.fire("rendered");return}n=this.payload,e&&(this.currentRow=e,r=e.clear().shift(),n=this.payload.slice(this.payload.indexOf(r))),this.currentRow||this.addRow();for(o in n)i=n[o],t.currentRow.addItem(i),i.hasLayout()||(t.currentRow.render(),!s&&t.options.singleRow&&(s=t.currentRow.height),t.addRow(),t.currentRow.addItem(i)),a.push(i);this.currentRow.end(),this.currentRow.render(),this.setStyles("displayCollection",{height:this.currentRow.offsetTop+this.currentRow.height+"px",position:"relative",margin:this.options.vertPadding+"px "+this.options.horizPadding+"px "+this.options.bottomPadding+"px "+(this.options.horizPadding+this.options.gutterWidth)+"px"}),s&&this.options.singleRow?u=s:u=this.currentRow.height,this.fire("adjustContainer"
,u),this.renderFragment(a),!this._cookieChecked&&!YUI.Env.isServer&&(this._cookieChecked=!0,setTimeout(function(){document.body.classList.remove("ui-state-wrong-cookie-width")},500))},reflow:function(){this.rows.forEach(function(e){e.destroy()}),this.rows=[],this.currentRow=null,this._bottom=null,this.render(),this.computeVisible(),this.fire("reflowed")},destroy:function(){this._scroll&&(this._scroll.shield.parentNode.removeChild(this._scroll.shield),this._scroll.shield=null,clearInterval(this._scroll.timer)),this._resize&&this._resize.handler.detach(),this.rows.forEach(function(e){e.destroy()}),this.rows=null,this.currentRow=null,e.LayoutEngine.prototype.destroy.apply(this)}}),e.LayoutEngineJustified=t},"@VERSION@",{requires:["flutil","flickr-promise","layout-engine","layout-engine-justified-row","hermes-template-display-collection-justified","display-collection-justified-css"]});
YUI.add("display-collection-justified",function(e){"use strict";var t,n=e.flutil,r,i=typeof window!="undefined"?window:{};r={scrollPositionHash:function(e){var t="dc_scrollToPhotoId_"+e.pathname+e.search;return t.replace(/[^\w\d]/gi,"")}},t=e.Base.create("DisplayCollectionJustified",e.DisplayCollection,[],{initializer:function(e){var t,r,s=e.gutterWidth||0,o=e.autoGutterToContentWidth||!1,u=this.get("container");return r=YUI.Env.isServer?{width:parseInt(this.appContext.getCookie("liqpw"),10),height:parseInt(this.appContext.getCookie("liqph"),10),scrollbarWidth:this.appContext.getCookie("liqsb")?parseInt(this.appContext.getCookie("liqsb"),10):16}:{scrollbarWidth:function(){var e,t;return e=document.createElement("div"),e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),t=100-e.clientWidth,e.parentNode.removeChild(e),n.setCookie({remove:!0,cookieName:"liqsb",path:"/",cookieValue:t}),t}()},this.options=n.extend(this.options,{canvas:"container",hibernate:!0},e),this.options.canvas==="screen"?(this.options.viewport=n.extend({width:r.width||i.innerWidth||800,height:r.height||i.innerHeight||600,scrollbarWidth:r.scrollbarWidth},this.options.viewport),o&&(s=(this.options.viewport.width-o)/2),this.options.viewport.width-=s*2):this.options.viewport=n.extend({width:u.get("offsetWidth"),height:u.get("offsetHeight")||i.innerHeight,scrollbarWidth:r.scrollbarWidth},this.options.viewport),t=n.extend({},this.options,{container:u,gutterWidth:s,autoGutterToContentWidth:o}),this.setupLayoutEngine(t),this},setupLayoutEngine:function(t){var n=this,r=!0,i,s;i=this.options.beaconViews?function(e){var t=n.options.beaconViews,r=document.URL;e.forEach(function(e){t.queue(e.photo&&e.photo.id,r,"true")})}:function(){},s=this.options.hibernate?this._queueForHibernation.bind(this):function(){},this.layout=new e.LayoutEngineJustified(t),this.layout.on("rendered",function(e){r&&!YUI.Env.isServer&&(r=!1,window.setTimeout(function(){n.layout.computeVisible()},0)),n.fire("rendered",e)}),this.layout.on("reflowed",function(t){e.Views.dialog.close()}),this.layout.on("bottom",function(e){e.loading=n.next(),n.fire("bottom",e)}),this.layout.on("visibilitychanged",function(e){var t=e.viewsVisible,r=0;s("wake",e.viewsIn,function(){s("hibernate",e.viewsOut),n._updateHistory(e.viewsVisible[0])}),window.paftTiming&&!window.paftTiming.final&&n.appContext.flipper.isFlipped("paft")&&(t.forEach(function(e){r<window.paftTiming[e.photo.id]&&(r=window.paftTiming[e.photo.id])}),n.appContext.clientMetrics&&(window.paftTiming.final=r,n.appContext.clientMetrics.record("photos_above_fold",r),n.appContext.clientMetrics.beaconLater())),i(e.viewsVisible)}),this.layout.on("scrollStop",function(){n.options.beaconViews&&n.options.beaconViews.flushQueue()})},positionFromHistory:function(){var e,t,n,i,s,o;if(YUI.Env.isServer)return;if(!window.localStorage)return;i=window.localStorage,e=i.getItem(r.scrollPositionHash(document.location)),o=[];for(t=0,n=i.length;t<n;t++)s=i.key(t),s.match(/^dc_scrollToPhotoId_/)&&o.push(s);o.forEach(function(e){i.removeItem(e)});if(!e)return;this.layout.scrollTo(e)},scrollToPhotoId:function(e,t){this.layout.scrollTo(e,t)},activate:function(){return this},_queueForHibernation:function(e,t,n){var r=25,s=t.length,o,u;if(!s)return n&&n();o=0,u=function(){var a,f=Math.min(s,o+r);for(a=o;a<f;a++)t[a][e]();if(f>=s-1)return n&&n();o=f-1,i.requestAnimationFrame(u)},i.requestAnimationFrame(u)},_updateHistory:function(e){if(YUI.Env.isServer)return;e&&e.photo&&window.localStorage.setItem(r.scrollPositionHash(document.location),e.photo.id)}}),e.DisplayCollectionJustified=t},"@VERSION@",{requires:["flutil","display-collection","layout-engine-justified","display-item-tile"]});
YUI.add("hermes-template-photo-collection",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["display-collection"],u):a.call(t,"outlet",t["display-collection"],u)))+'\n\n<div class="progress-indicator">\n	<span class="fetching-message">',u={hash:{intlName:"photo-list.FETCHING_PHOTOS"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</span>\n	<span class="fetching-more-message">',u={hash:{intlName:"photo-list.FETCHING_MORE_PHOTOS"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</span>\n	<span class="searching-message">',u={hash:{intlName:"photo-list.SEARCHING"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+"</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-collection",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("search-photos-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,this.EMPTY_QUERY_ID=-1,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-search"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher","search-helper"]});
YUI.add("flickr-photos-search-fetcher",function(e){"use strict";function t(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||e.SearchHelper.FETCH_PAGE_SIZE,page:t.page||1},r;return r=e.merge(n,t.apiParams||{}),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(r),e.SearchHelper.isParameterlessSearch(r)?null:r}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a,f,l={id:n.id,apiParams:e.QueryString.parse(n.id),emptyQuery:!!n.emptyQuery,photos:[]},c;if(!n.id)throw new ReferenceError("No `id` provided by request.");if(!r.photos||!r.photos.photo)throw new Error("No `photos.photo` property returned by API.");return f=e.APIHelper.response.parsePhotos({photos:r.photos.photo,photoModelRegistry:s,personModelRegistry:o,photoEngagementModelRegistry:u}),l.photos={perPage:r.photos.perpage,page:r.photos.page||1,pageContent:f,totalItems:r.photos.total},i.exists(l.id)?(a=i.getValue(l.id,"photos").getList(),c=a.reduce(function(e,t){return e[t.id]=!0,e},{}),l.photos.pageContent=l.photos.pageContent.filter(function(e){return!c[e.id]}),l.photos.page===1&&(l.photos.forceAppend=!0),i.setValue(l.id,"photos",l.photos)):i.add(l),l.photos.pageContent}function r(t,n){var r=this,i="flickr.photos.search",s=t.emptyQuery?{}:this._processParams(t);return s||(t.emptyQuery=!0),e.batch(t.emptyQuery?new e.AutoResolvingPromise({photos:{photo:[]}}):n.callAPI(i,s),n.getModelRegistry("search-photos-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-engagement-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-favorites-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photos-search"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","type-validator","search-helper","querystring-parse-simple"],optional:["search-photos-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("search-photos-collection-view",function(e){e.namespace("Views")[this.name]=e.Base.create("search-photos-collection-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.searchId=e.searchId,this.paft=e.paft,this},loadState:function(){var t=this,n;return n={appContext:this.appContext,container:this.get("container").one(".display-collection-justified"),beaconViews:this.appContext.getViewCounter({flushDelay:6e4}),canvas:"screen",displayItemExtras:{}},this.paft&&(n.displayItemExtras.paft=!0),this.displayCollection=new e.DisplayCollectionJustified(n),this.searchId?this.appContext.getModel("search-photos-models",this.searchId).then(function(n){return t.searchModel=n,t.searchCollection=new e.CollectionPaginator(n,"photos",{fetchPageSize:e.SearchHelper.FETCH_PAGE_SIZE}),t.searchCollection.passAttributesToFetcher("apiParams"),t.registerSubview(t.displayCollection),t.displayCollection.appendCollection(t.searchCollection),t.displayCollection.initialize()}):new e.AutoResolvingPromise},buildContainer:function(){var e=this;return e.setContainerHTML(e.templates("photo-collection")({"display-collection":e.displayCollection,paft:e.paft})),this.displayCollection.positionFromHistory(),this},activate:function(){return this.registerEventHandler(this.displayCollection.on("bottom",function(e){this.searchModel.getValue("photos").fetchedEnd||this.displayLoadingIndicator("fetching-more")},this)),this.registerEventHandler(this.get("container").delegate("click",this.injectPhotolistContext.bind(this),"a")),this},displayLoadingIndicator:function(e){var t=this.get("container").one(".progress-indicator");t.addClass(e),t.addClass("progress-loading"),this.registerEventHandler(this.displayCollection.on("rendered",function(n){t.removeClass(e),t.removeClass("progress-loading")}))},injectPhotolistContext:function(t){var n=t.currentTarget.getAttribute("href"),r=e.URLHelper.PHOTOPAGE_PATTERN.exec(n),i,s,o,u;r&&r.length>=5&&(i=this.searchCollection.getCurrentPageAsList().map(function(e){return e.id}),s=i.indexOf(r[4]),o=i.slice(i).slice(s,s+50),o.length<50&&(o=i.slice(s-(50-o.length),s).concat(o)),u=n+"/in/photolist-"+e.URLHelper.generateShortenedPhotolist(o),t.halt(),e.rapidTracker.beacon(this.name,"searchPhotoResultClick",{vespaRnk:s+1}),this.appContext.lang.toLowerCase()==="en-us"?this.appContext.flapp.navigate(u):window.location=u)}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","collection-paginator","display-collection-justified","hermes-template-photo-collection","photo-collection-css","url-helper","search-helper"],optional:["search-photos-models"],langBundles:["search","photo-list"]});
YUI.add("hermes-lang-search",function(e,t){e.Intl.add("hermes/search","en-US",{RELEVANT:["Relevant"],RECENT:["Recent"],INTERESTING:["Interesting"],DEFAULT_SEARCH:['This is where you search Flickr. Here\'s a search for <span class="default-search">',"${query}","</span> to get you started!"],FLICKR_SEARCH:["Flickr Search"],NO_MATCHES_FOR_QUERY_TERM:["Oops! There are no matches for \u201c","${searchTerm}","\u201d."],NO_MATCHES_FOR_QUERY:["Oops! There are no matches for your search."],TRY_DIFFERENT:["Please try refining your search."],SEARCH_ERROR:["Oops! The date you entered does not exist."],SEARCH_START:["Start your search"],SEARCHING:["Searching"],FETCHING_PHOTOS:["Fetching more photos..."],SEARCH:["Search"],START_YOUR_SEARCH:["Start your search"],BY_USER:["by ","${user}"],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in your photos."],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in your contacts' photos."],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in this user's photos."],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in this group."],NO_MATCHES_FOR_QUERY_TERM_YOUR:["Oops! There are no matches for your search in your photos."],NO_MATCHES_FOR_QUERY_TERM_CONTACTS:["Oops! There are no matches for your search in your contacts' photos."],NO_MATCHES_FOR_QUERY_TERM_USER:["Oops! There are no matches for your search in this user's photos."],NO_MATCHES_FOR_QUERY_TERM_GROUP:["Oops! There are no matches for your search in this group."],API_ERROR_HEADER:["Oh noes! We couldn't process your search."],API_ERROR_SUBHEADER:["Please change it up a bit and try again."]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-photo-list",function(e,t){e.Intl.add("hermes/photo-list","en-US",{FETCHING_PHOTOS:["Fetching photos..."],FETCHING_MORE_PHOTOS:["Fetching more photos..."],SEARCHING:["Searching..."]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-footer-full",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function d(e,t){var r="",i,s;r+='\n					<li class="foot-li">\n						<div class="ui-dropdown simple-drop drop-up">\n							<span>',s={hash:{},inverse:c.noop,fn:c.program(2,v,t),data:t},(i=n.selectedLang)?i=i.call(e,s):(i=e.selectedLang,i=typeof i===f?i.apply(e):i),n.selectedLang||(i=h.call(e,i,s));if(i||i===0)r+=i;r+='</span>\n							\n							<span class="ui-dialog-arrow"></span>\n							\n							<ul>\n								',i=n.each.call(e,e.menuLangs,{hash:{},inverse:c.noop,fn:c.program(4,m,t),data:t});if(i||i===0)r+=i;return r+='\n							</ul>\n							\n							<div class="ui-dropdown-shim"></div>\n						</div>\n					</li>\n					',r}function v(e,t){var r="",i;return r+='\n								<a data-track="',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-action="/change_language.gne?lang=',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+"&csrf=",(i=n.csrf)?i=i.call(e,{hash:{},data:t}):(i=e.csrf,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-value="',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+'" href="/change_language.gne?lang=',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+"&csrf=",(i=n.csrf)?i=i.call(e,{hash:{},data:t}):(i=e.csrf,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-text="',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+'">',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+"</a>\n							",r}function m(e,t){var r="",i;return r+='\n									<li data-action="set" data-value="/change_language.gne?lang=',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+"&csrf=",(i=n.csrf)?i=i.call(e,{hash:{},data:t}):(i=e.csrf,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-text="',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+'"><a data-track="',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-action="/change_language.gne?lang=',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+"&csrf=",(i=n.csrf)?i=i.call(e,{hash:{},data:t}):(i=e.csrf,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-value="',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+'" href="/change_language.gne?lang=',(i=n.code)?i=i.call(e,{hash:{},data:t}):(i=e.code,i=typeof i===f?i.apply(e):i),r+=l(i)+"&csrf=",(i=n.csrf)?i=i.call(e,{hash:{},data:t}):(i=e.csrf,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-text="',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+'">',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+"</a></li>\n								",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.blockHelperMissing,p=n.helperMissing;s+='<footer class="foot">\n	<div class="foot-container centered-content">\n		<div class="foot-top-row">\n			<div class="foot-nav pure-menu-horizontal">\n				<ul class="foot-nav-ul">\n					<li class="foot-li"><a href="/about">',a={hash:{intlName:"common.ABOUT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="/jobs">',a={hash:{intlName:"common.JOBS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="//blog.flickr.net/en">',a={hash:{intlName:"common.BLOG"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="//mobile.yahoo.com/flickr">',a={hash:{intlName:"common.MOBILE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="/services/developer">',a={hash:{intlName:"common.DEVELOPERS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="/help/guidelines">',a={hash:{intlName:"common.GUIDELINES"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="//yahoo.uservoice.com/forums/211185-us-flickr">',a={hash:{intlName:"common.FEEDBACK"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="/abuse">',a={hash:{intlName:"common.REPORT_ABUSE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="/help/forum">',a={hash:{intlName:"common.HELP_FORUM"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+"</a></li>\n					\n					",a={hash:{},inverse:c.noop,fn:c.program(1,d,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-footer-lang",a):p.call(t,"isFlipped",t.flippers,"enable-footer-lang",a));if(u||u===0)s+=u;return s+='\n				</ul>\n			</div>\n		</div>\n		<div class="pure-g foot-info foot-bottom-row">\n			<div class="pure-u-1-3 foot-lang">\n				<ul class="pure-menu-horizontal">\n					<li class="foot-li"><a href="//info.yahoo.com/privacy/us/yahoo/flickr/details.html">',a={hash:{intlName:"common.PRIVACY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="//info.yahoo.com/legal/us/yahoo/utos/utos-173.html">',a={hash:{intlName:"common.TERMS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="//safely.yahoo.com">',a={hash:{intlName:"common.YAHOO_SAFELY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage"
,a)))+'</a></li>\n					<li class="foot-li"><a href="//help.yahoo.com/kb/flickr">',a={hash:{intlName:"common.HELP"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'</a></li>\n				</ul>\n			</div>\n			\n			<div class="pure-u-1-3 foot-company">\n				',a={hash:{intlName:"common.A_YAHOO_COMPANY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):p.call(t,"intlMessage",a)))+'\n			</div>\n			\n			<div class="pure-u-1-3 foot-social">\n				<ul class="pure-menu-horizontal">\n					<li><a class="ft-icon hide-text ft-tumblr" href="http://flickr.tumblr.com/">Tumblr</a></li>\n					<li><a class="ft-icon hide-text ft-facebook" href="https://www.facebook.com/flickr">Facebook</a></li>\n					<li><a class="ft-icon hide-text ft-twitter" href="https://twitter.com/flickr">Twitter</a></li>\n					'+'\n					<li><a class="ft-icon hide-text ft-googleplus" href="https://plus.google.com/+flickr/about">Google Plus</a></li>\n				</ul>\n			</div>\n		</div>\n	</div>\n</footer>\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/footer-full",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("dropdown",function(e){"use strict";var t,n;t={css:{closed:"ui-dropdown-closed",shim:"ui-dropdown-shim",label:'span[data-action="toggle"]',items:"[data-value]",itemSelected:"ui-dropdown-item-selected",hasDialogArrow:"ui-dropdown-has-dialog-arrow",dialogArrow:"ui-dialog-arrow",useCheckMarks:"ui-dropdown-use-checkboxes"},options:{hasDialogArrow:!1,useCheckMarks:!1}},e.namespace("Views").Dropdown=n=e.Base.create("Dropdown",e.FlickrView,[],{initializer:function(e){if(e.activate===!1)return;this.activate()},activate:function(){var n=this,r=this.get("container"),i;this.close(),this._items={},e.Lang.isArray(this.get("selected"))||this.set("selected",[this.get("selected")]),r.all(t.css.items).each(function(e){var t=e.getData();n._items[t.value]={text:t.text||'no data-text for "'+t.value+'"',sub:t.sub,node:e}}),this.labelEl=r.one(t.css.label),this.labelEl||(this.labelEl=e.Node.create('<span class="truncate" data-action="toggle" />'),r.insert(this.labelEl,0)),i=this.get("staticLabel")||this.get("defaultLabel"),i&&(i===!0?this.labelEl.set("text","set staticLabel/defaultLabel to a string, not `true`"):this.labelEl.set("text",i)),this.get("hasDialogArrow")&&!r.hasClass(t.css.hasDialogArrow)&&r.addClass(t.css.hasDialogArrow),r.hasClass(t.css.hasDialogArrow)&&(this.dialogArrowEl=r.one(t.css.dialogArrow),this.dialogArrowEl||(this.dialogArrowEl=e.Node.create('<span class="ui-dialog-arrow" />'),r.insert(this.dialogArrowEl,1))),this.get("useCheckMarks")&&!r.hasClass(t.css.useCheckMarks)&&r.addClass(t.css.useCheckMarks),this.select();if(this.get("disabled"))return this.disable();this.attachEvents({":toggle":this.toggle.bind(this),":set":function(t,r){t.halt();if(!n.get("multiSelect")&&!n.get("multiSelectSub")&&e.Array.indexOf(n.get("selected"),r.value)>=0)return n.close();n.select(r.value,r)}})},select:function(n,r,i){var s=this,o=n?this._items[n]:null,u=!0,a=[],f;o&&e.Array.indexOf(this.get("selected"),n)>=0&&(this.get("multiSelect")||this.get("multiSelectSub"))?(a=this.get("selected"),!o.sub&&this.get("multiSelect")&&a.length>this.get("minimumSelected")?(a.splice(e.Array.indexOf(this.get("selected"),n),1),u=!1):o.sub&&(a.splice(e.Array.indexOf(this.get("selected"),n),1),u=!1),this.set("selected",a)):o&&(o.sub?(a.push(n),this.get("selectParent")&&a.push(o.sub),e.Array.each(this.get("selected"),function(e){s._items[e].sub===o.sub?a.push(e):s.get("multiSelect")&&!s._items[e].sub&&a.push(e)})):this.get("multiSelect")?(a=this.get("selected"),a.push(n)):a.push(n),this.set("selected",a)),i||this.close(),f={clicked:o?{text:o.text,value:n,sub:o.sub,itemEl:o.node,isChecked:u}:null,data:r,selections:a},this.fire("selected",f),this.update(n,f,t)},update:function(t,n,r){var i=this,s=n.clicked,o=this.get("selected"),u=this.get("defaultLabel")||"[Unable to select a default item]";this.get("staticLabel")||(this.get("labelFunction")?u=this.get("labelFunction").apply(this,[t]):s?n.data&&n.data.text&&n.data.text!==s.text?u=n.data.text:u=s.text:o.length>0&&i._items[o[0]]&&(u=i._items[o[0]].text),this.labelEl.set("textContent",u||"[!empty data-text!]")),this.get("container").all(r.css.items).removeClass(r.css.itemSelected),e.Array.each(o,function(e){i._items[e]&&i._items[e].node.addClass(r.css.itemSelected)})},toggle:function(e){e&&e.halt(),this._open?this.close(e):this.open(e)},open:function(e){var n=this.get("container"),r=0,i=0,s=30;this._open=!0,this.get("shouldCreateShim")&&this._shimUp(),n.removeClass(t.css.closed),this.get("autoSizeMenu")&&(r=parseInt(this.labelEl.getComputedStyle("width"),10),i=parseInt(n.one("ul").getComputedStyle("width"),10),r+s>i&&n.one("ul").setStyles({width:r+s})),(!e||!e.silent)&&this.fire("open",e)},close:function(e){e&&e.halt(),this._open=!1,this._shimUp(!1),this.fire("close",e),this.get("container").addClass(t.css.closed)},_shimUp:function(n){if(n===!1){if(!this._shim)return;this._shim.detach("click").remove(),this._shim=null;return}this._shim=e.Node.create("<div />"),this._shim.addClass(t.css.shim),this._shim.on("click",this.close.bind(this)),this.get("container").appendChild(this._shim)},disable:function(){var e=this.get("container");this.set("disabled",!0),this.close(),e.addClass(t.css.disabled),e.detach()},destructor:function(){this._shimUp(!1),this._items=null,this.labelEl=null,this.set("selected",null),this.detachAll()}},{ATTRS:{selected:{value:[]},disabled:{value:!1},hasDialogArrow:{value:!1},useCheckMarks:{value:!1},multiSelect:{value:!1},multiSelectSub:{value:!1},selectParent:{value:!0},minimumSelected:{value:0},staticLabel:{value:!1},defaultLabel:{value:!1},labelFunction:function(){},shouldCreateShim:{value:!0},autoSizeMenu:{value:!0}}})},"@VERSION@",{requires:["flickr-view","flickrui-css"]});
YUI.add("footer-full-view",function(e){var t=["en-US","zh-HK","de-DE","es-US","fr-FR","ko-KR","it-IT","pt-BR","vi-VN","id-ID"],n={"en-US":"English","de-DE":"Deutsch","es-US":"Espa\u00f1ol","fr-FR":"Fran\u00e7ais","ko-KR":"\ud55c\uae00","it-IT":"Italiano","pt-BR":"Portugu\u00eas","vi-VN":"Ti\u1ebfng Vi\u1ec7t","id-ID":"Bahasa Indonesia","zh-HK":"\u7e41\u9ad4\u4e2d\u6587"},r;r={debug:!1,css:{langMenu:".foot-lang-list .ui-dropdown"}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").html===""&&this.setContainerHTML('<div class="footer-full-content"></div>'),this.appStateParams=e,this},subviewConfig:{},loadState:function(){var r,i,s;s=this.appContext.auth.csrf?this.appContext.auth.csrf:"",this.lang=this.appContext.lang,this.menuLangs=[],this.lang==="zh-Hant-HK"&&(this.lang="zh-HK"),this.selectedLang={code:this.lang,name:n[this.lang],csrf:s};for(r=0,i=t.length;r<i;r++){if(t[r]===this.lang)continue;typeof t[r]=="string"&&this.menuLangs.push({code:t[r].toLowerCase(),name:n[t[r]],csrf:s})}return new e.AutoResolvingPromise},buildContainer:function(){var t={},n;return this.get("viewer")&&(t=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),n={flippers:this.appContext.flipper.toJSON(),displayLangs:this.displayLangs,selectedLang:this.selectedLang,menuLangs:this.menuLangs},this.setContainerHTML(this.templates("footer-full")(n)),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-footer-full","footer-full-css","url-helper","flickrui-css","flickrui-dialogs-css","dropdown"],langBundles:["common"]});
YUI.add("togglebutton",function(e){"use strict";var t,n;t={css:{toggledOn:"ui-togglebutton-on",label:'span[data-action="toggle"]',disabled:"ui-togglebutton-disabled",icon:"ui-togglebutton-icon"},options:{}},e.namespace("Views").ToggleButton=n=e.Base.create("ToggleButton",e.FlickrView,[],{initializer:function(e){if(e.activate===!1)return;this.activate()},activate:function(){var n=this.get("container");n.getData("label")&&this.set("label",n.getData("label")),n.getData("labelToggled")&&this.set("labelToggled",n.getData("labelToggled")),this.labelEl=n.one(t.css.label),this.labelEl||(this.labelEl=e.Node.create('<span class="truncate" data-action="toggle" />'),n.insert(this.labelEl,0)),this.update(this.get("toggled")),this.get("showIcon")&&n.addClass(t.css.icon);if(this.get("disabled"))return this.disable();this.attachEvents({":toggle":this.toggle.bind(this)})},update:function(e){var n=this.get("container");e?(n.addClass(t.css.toggledOn),this.get("labelToggled")&&n.one(t.css.label).set("textContent",this.get("labelToggled"))):(n.removeClass(t.css.toggledOn),n.one(t.css.label).set("textContent",this.get("label")))},toggle:function(e){e,this.set("toggled",!this.get("toggled")),this.update(this.get("toggled")),this.fire("toggle",e,this.get("toggled")?"on":"off")},disable:function(){var e=this.get("container");this.set("disabled",!0),e.addClass(t.css.disabled),e.detach()},destructor:function(){this.labelEl=null,this.detachAll()}},{ATTRS:{disabled:{value:!1},toggled:{value:!1},label:{value:"Toggle Me"},labelToggled:{value:"Toggled!"},showIcon:{value:!1}}})},"@VERSION@",{requires:["flickr-view","flickrui-css"]});
YUI.add("hermes-template-filter-bar-neutered",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n						<li role="menuitem" data-track="searchFilterScopeYourPhotosClick" data-action="set" data-value="1" data-text="',s={hash:{intlName:"filter-bar.YOUR_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.YOUR_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'</li>\n						<li role="menuitem" data-track="searchFilterScopeYourContactsPhotosClick" data-action="set" data-value="2" data-text="',s={hash:{intlName:"filter-bar.CONTACTS_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.CONTACTS_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</li>\n					",r}function d(e,t){var r="",i,s;return r+='\n						<li role="menuitem" data-track="searchFilterScopeContactPhotosClick" data-action="set" data-value="3" data-text="',s={hash:{intlName:"filter-bar.USER_PHOTOS",name:(i=e.personModel,i==null||i===!1?i:i.displayname)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be" data-nsid="'+l((i=(i=e.personModel,i==null||i===!1?i:i.nsid),typeof i===c?i.apply(e):i))+'">',s={hash:{intlName:"filter-bar.USER_PHOTOS",name:(i=e.personModel,i==null||i===!1?i:i.displayname)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</li>\n					",r}function v(e,t){var r="",i,s;return r+='\n						<li role="menuitem" data-track="searchFilterScopeGroupPhotosClick" data-action="set" data-value="4" data-text="',s={hash:{intlName:"filter-bar.GROUP_PHOTOS",name:(i=e.groupModel,i==null||i===!1?i:i.title)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be" data-nsid="'+l((i=(i=e.groupModel,i==null||i===!1?i:i.id),typeof i===c?i.apply(e):i))+'">',s={hash:{intlName:"filter-bar.GROUP_PHOTOS",name:(i=e.groupModel,i==null||i===!1?i:i.title)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</li>\n					",r}function m(e,t){var r="",i,s;return r+='\n		<li role="menuitem">\n			<div class="filter-cc-label ui-togglebutton ui-togglebutton-icon ui-unselectable-text" data-label="',s={hash:{intlName:"filter-bar.LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+':" data-labeltoggled="',s={hash:{intlName:"filter-bar.LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+':">\n				<span class="truncate filter-title" data-action="toggle"></span>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="filter-cc-menu ui-dropdown ui-dropdown-closed ui-unselectable-text">\n				<span class="truncate filter-title" data-action="toggle"></span>\n				<span class="ui-dialog-arrow"></span>\n				<ul class="filter-submenu" role="menu">\n					<li role="menuitem" data-track="searchFilterLicenseAll" data-action="set" data-value="all" data-text="',s={hash:{intlName:"filter-bar.ANY_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.ANY_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'</li>\n					<li role="menuitem" data-track="searchFilterLicenseCCOnly" data-action="set" data-value="cc" data-text="',s={hash:{intlName:"filter-bar.CC_LICENSE_PARENT"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.CC_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'</li>\n					<li role="menuitem" data-track="searchFilterLicenseCCCommericialUse" data-action="set" data-value="cc-comm" data-sub="cc" data-text="',s={hash:{intlName:"filter-bar.CC_LICENSE_PARENT"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.COMM_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'</li>\n					<li role="menuitem" data-track="searchFilterLicenseCCModifyAdaptBuild" data-action="set" data-value="cc-deriv" data-sub="cc" data-text="',s={hash:{intlName:"filter-bar.CC_LICENSE_PARENT"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.DERIV_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</li>\n				</ul>\n			</div>\n		</li>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="filter-bar-content">\n\n	<ul class="filter-menu" role="menubar">\n		<li role="menuitem">\n			<div class="filter-sort-label ui-togglebutton ui-togglebutton-icon ui-unselectable-text" data-label="',a={hash:{intlName:"filter-bar.SORT_BY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+':" data-labeltoggled="',a={hash:{intlName:"filter-bar.SORT_BY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+':">\n				<span class="truncate filter-title" data-action="toggle"></span>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="ui-dropdown ui-dropdown-closed ui-unselectable-text filter-sort-menu">\n				<span class="truncate filter-title" data-action="toggle"></span>\n				<span class="ui-dialog-arrow"></span>\n				<ul class="filter-submenu" role="menu">\n					<li role="menuitem" data-track="searchFilterSortRelevanceClick" data-action="set" data-value="relevance" data-text="',a={hash:{intlName:"filter-bar.RELEVANT"},data:i},s+=l
((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.RELEVANT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</li>\n					<li role="menuitem" data-track="searchFilterSortRecentClick" data-action="set" data-value="date-posted-desc" data-text="',a={hash:{intlName:"filter-bar.RECENT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.RECENT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</li>\n					<li role="menuitem" data-track="searchFilterSortInterestingClick" data-action="set" data-value="interestingness-desc" data-text="',a={hash:{intlName:"filter-bar.INTERESTING"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.INTERESTING"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</li>\n				</ul>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="filter-search-label ui-togglebutton ui-togglebutton-icon ui-unselectable-text" data-label="',a={hash:{intlName:"filter-bar.SEARCH_IN"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+':" data-labeltoggled="',a={hash:{intlName:"filter-bar.SEARCH_IN"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+':">\n				<span class="truncate filter-title" data-action="toggle"></span>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="search-scope-menu ui-dropdown ui-dropdown-closed ui-unselectable-text ui-dropdown-ellipsis">\n				<span class="truncate filter-title" data-action="toggle"></span>\n				<span class="ui-dialog-arrow"></span>\n				<ul class="filter-submenu" role="menu">\n					<li role="menuitem" data-track="searchFilterScopeEveryoneClick" data-action="set" data-value="0" data-text="',a={hash:{intlName:"filter-bar.EVERYONE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.EVERYONE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+"</li>\n\n					",u=n["if"].call(t,(o=t.viewer,o==null||o===!1?o:o.signedIn),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n\n					",u=n["if"].call(t,t.showUserOption,{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n\n					",u=n["if"].call(t,t.groupModel,{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='\n\n					<li role="menuitem" data-track="searchFilterScopeUsersClick" data-action="set" data-value="5" data-text="',a={hash:{intlName:"filter-bar.PEOPLE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.PEOPLE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</li>\n					<li role="menuitem" data-track="searchFilterScopeGroupsClick" data-action="set" data-value="6" data-text="',a={hash:{intlName:"filter-bar.GROUPS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.GROUPS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+"</li>\n				</ul>\n			</div>\n		</li>\n		",a={hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-license-search",a):f.call(t,"isFlipped",t.flippers,"enable-license-search",a));if(u||u===0)s+=u;return s+='\n		<li role="menuitem" class="filter-bar-right">\n			<a href="/search/advanced/',(u=n.advancedSearchQueryStr)?u=u.call(t,{hash:{},data:i}):(u=t.advancedSearchQueryStr,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',a={hash:{intlName:"filter-bar.ADVANCED_SEARCH"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+"</a>\n		</li>\n	</ul>\n\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/filter-bar-neutered",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("filter-bar-neutered-view",function(e){var t;t={css:{sortMenu:".filter-sort-menu",sortLabel:".filter-sort-label",searchScopeMenu:".search-scope-menu",searchLabel:".filter-search-label",ccLabel:".filter-cc-label",ccMenu:".filter-cc-menu"}},e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.searchId=e.searchId,this.apiParams={},this.elementStates=this.setElementStates(e),this},subviewConfig:{},loadState:function(){var t=this,n,r,i=t.appContext.getViewer();return this.searchId?n=this.appContext.getModel("search-photos-models",this.searchId).then(function(n){var r=n.getValue("apiParams"),i,s=null,o=null;return t.searchModel=n,r.group_id?(i={},e.TypeValidator.matches.nsid(r.group_id)?i.id=r.group_id:i.pathAlias=r.group_id,s=t.appContext.getModel("group-pool-models",i)):s=e.AutoResolvingPromise(),r.user_id?(i={},e.TypeValidator.matches.nsid(r.user_id)?i.id=r.user_id:i.pathAlias=r.user_id,o=t.appContext.getModel("person-models",i)):o=e.AutoResolvingPromise(),e.batch(s,o).then(function(e){e[0]&&(t.groupModel=e[0]),e[1]&&(t.personModel=e[1])})}):n=new e.AutoResolvingPromise,i.signedIn?r=t.appContext.getModel("person-preferences-models",i.nsid).then(function(e){t.personPreferencesModel=e}):r=new e.AutoResolvingPromise,e.batch(n,r).then(function(){t.searchModel?t.apiParams=t.searchModel.getValue("apiParams"):e.SearchHelper.addParamDefaults(t.apiParams,t.personPreferencesModel)})},buildContainer:function(){var e="";return this.searchModel&&(e=this.generateAdvancedSearchQuery(this.searchModel.getValue("apiParams"))),this.setContainerHTML(this.templates("filter-bar-neutered")({elements:this.elementStates,advancedSearchQueryStr:e,viewer:this.appContext.getViewer(),showUserOption:this.personModel&&this.personModel.getValue("nsid")!==this.appContext.getViewer().nsid,personModel:this.personModel&&this.personModel.toJSON(),groupModel:this.groupModel&&this.groupModel.toJSON(),flippers:this.appContext.flipper.toJSON()})),this},activate:function(){var n=this,r=this.appContext.getViewer(),i;return this.filterViews={},this.elementStates.searchScope&&(i=this.getSearchScopeState(this.apiParams,r,this.personModel),this.filterViews.searchLabel=this.createLabelButton(t.css.searchLabel),this.filterViews.searchScope=this.createSimpleDropdown(t.css.searchScopeMenu,i),this.registerEventHandler(this.filterViews.searchScope.on("selected",function(t){var r=e.clone(n.apiParams),i="/search/?";delete r.user_id,delete r.group_id,delete r.contacts;switch(t.clicked.value){case"1":r.user_id=n.appContext.getViewer().nsid;break;case"2":r.contacts="all";break;case"3":r.user_id=t.clicked.itemEl.getData("nsid");break;case"4":r.group_id=t.clicked.itemEl.getData("nsid");break;case"5":i="/search/people/?",r={q:n.apiParams.q||n.apiParams.text||n.apiParams.tags},n.classicNavigate(i+e.QueryString.stringify(r));break;case"6":i="/search/groups/?",r={q:n.apiParams.q||n.apiParams.text||n.apiParams.tags},n.classicNavigate(i+e.QueryString.stringify(r))}e.SearchHelper.addParamDefaults(r,n.personPreferencesModel),n.navigate(i+e.QueryString.stringify(r))})),this.bindOpenEvent(this.filterViews.searchScope)),this.elementStates.sort&&(this.filterViews.sortLabel=this.createLabelButton(t.css.sortLabel),i=this.apiParams[e.SearchHelper.API.sort],this.filterViews.sort=this.createSimpleDropdown(t.css.sortMenu,i),this.bindSelectedEvent(this.filterViews.sort,e.SearchHelper.API.sort),this.bindOpenEvent(this.filterViews.sort)),this.elementStates.license&&(this.filterViews.ccLabel=this.createLabelButton(t.css.ccLabel),i=this.determineLicenseForUI(this.apiParams[e.SearchHelper.API.license]||"all"),this.filterViews.creativeCommons=new e.Views.Dropdown({appContext:this.appContext,container:this.get("container").one(t.css.ccMenu),selected:i,hasDialogArrow:!0,useCheckMarks:!0,multiSelect:!1,multiSelectSub:!0,selectParent:!0,minimumSelected:1,shouldCreateShim:!1,autoSizeMenu:!1}),this.bindSelectedEvent(this.filterViews.creativeCommons,e.SearchHelper.API.license),this.bindOpenEvent(this.filterViews.creativeCommons)),n},getSearchScopeState:function(e,t,n){var r=0;return e.user_id&&e.group_id?t.signedIn&&n&&n.getValue("nsid")===t.nsid?r=1:r=3:t.signedIn&&e.group_id&&e.contacts?r=2:e.user_id?t.signedIn&&n&&n.getValue("nsid")===t.nsid?r=1:r=3:e.contacts?r=2:e.group_id&&(r=4),r},determineLicenseForAPI:function(t){var n,r=t.indexOf("all")>=0,i=t.indexOf("cc")>=0,s=t.indexOf("cc-comm")>=0,o=t.indexOf("cc-deriv")>=0;return r?n=e.SearchHelper.LICENSE_TYPE.all:i&&s&&o?n=e.SearchHelper.LICENSE_TYPE.commderiv:i&&s?n=e.SearchHelper.LICENSE_TYPE.comm:i&&o?n=e.SearchHelper.LICENSE_TYPE.deriv:i&&(n=e.SearchHelper.LICENSE_TYPE.cc),n},determineLicenseForUI:function(t){var n;switch(t){case e.SearchHelper.LICENSE_TYPE.commderiv:n=["cc","cc-comm","cc-deriv"];break;case e.SearchHelper.LICENSE_TYPE.comm:n=["cc","cc-comm"];break;case e.SearchHelper.LICENSE_TYPE.deriv:n=["cc","cc-deriv"];break;case e.SearchHelper.LICENSE_TYPE.cc:n=["cc"];break;default:n=["all"]}return n},classicNavigate:function(t){window.location=e.url(t)},createSimpleDropdown:function(t,n){return new e.Views.Dropdown({appContext:this.appContext,container:this.get("container").one(t),selected:n,useCheckMarks:!0,shouldCreateShim:!1,autoSizeMenu:!1})},createLabelButton:function(t){return new e.Views.ToggleButton({appContext:this.appContext,container:this.get("container").one(t)})},bindSelectedEvent:function(t,n){var r=this;this.registerEventHandler(t.on("selected",function(t){var i=r.apiParams,s={};n==="license"?s[n]=r.determineLicenseForAPI(t.selections):s[n]=t.clicked.value,i=e.merge(i,s),e.SearchHelper.addParamDefaults(i,r.personPreferencesModel),!t.data||!t.data.track?r.appContext.warn("No data-track attribute found on clicked element. Not beaconing."):e.rapidTracker.beacon(r.name,t.data.track),r.navigate("/search/?"+e.QueryString.stringify(i))}))},navigate:function(e){e&&(this.fire("navigating"),this.appContext.flapp.navigate
(e))},bindOpenEvent:function(t){var n=this;this.registerEventHandler(t.on("open",function(t){n.openDropdown&&n.openDropdown.close(),n.openDropdown=t.target,n.registerEventHandler(e.one("body").once("click",function(){n.openDropdown&&n.openDropdown.close()}))})),this.registerEventHandler(t.on("close",function(e){n.openDropdown=null}))},setElementStates:function(e){var t={searchScope:!0,sort:!0,license:this.appContext.flipper.isFlipped("enable-license-search")};return t},generateAdvancedSearchQuery:function(t){var n=e.SearchHelper.mapAPIParamsToAdvancedSearchQuery(t);return t.q&&(n.q=t.q),"?"+e.QueryString.stringify(n)},destructor:function(){var e;for(e in this.filterViews)this.filterViews[e].destroy()}})},"@VERSION@",{requires:["flickrui-css","dropdown","togglebutton","flickr-view","flickr-promise","person-models","group-pool-models","search-photos-models","search-helper","hermes-template-filter-bar-neutered","filter-bar-neutered-css","url"],langBundles:["filter-bar"]});
YUI.add("hermes-lang-filter-bar",function(e,t){e.Intl.add("hermes/filter-bar","en-US",{EVERYONE:["Everyone's Photos"],YOUR_PHOTOS:["Your Photos"],CONTACTS_PHOTOS:["Your Contacts' Photos"],USER_PHOTOS:["${name}","'s Photos"],GROUP_PHOTOS:["Photos in ","${name}"],PEOPLE:["People"],GROUPS:["Groups"],USER_PHOTOS_IN_GROUP:["${name}","'s Photos in ","${group}"],YOUR_PHOTOS_IN_GROUP:["Your Photos in ","${group}"],CONTACTS_PHOTOS_IN_GROUP:["Your Contacts' Photos in ","${group}"],YOUR_FAVORITES:["Your Favorites"],MORE:["More"],LESS:["Less"],PHOTOS_VIDEOS:["Photos & Videos"],ONLY_PHOTOS:["Only Photos"],ONLY_VIDEOS:["Only Videos"],ALL_TIME:["All Time"],DATE_TAKEN:["Date Taken"],DATE_POSTED:["Date Posted"],FROM:["From"],TO:["To"],MONTH_CHARS:["mm"],DAY_CHARS:["dd"],YEAR_CHARS:["yyyy"],DATE_INVALID:["Date invalid"],DONE:["Done"],DATE:["Date"],LICENSE:["License"],ANY_LICENSE:["Any License"],CC_LICENSE:["Creative Commons only"],CC_LICENSE_PARENT:["Creative Commons"],COMM_LICENSE:["Commercial use allowed"],DERIV_LICENSE:["Modifications allowed"],SS_ON:["SafeSearch on"],ON:["On"],SS_MOD:["SafeSearch moderate"],MOD:["Moderate"],SS_OFF:["SafeSearch off"],OFF:["Off"],RELEVANT:["Relevant"],RECENT:["Recent"],INTERESTING:["Interesting"],SORT_BY:["Sort"],SEARCH_IN:["Search"],ADVANCED_SEARCH:["Advanced Search"]})},"@VERSION@",{requires:["intl"]});
YUI.add("search-photos-page-view",function(e){e.namespace("Views")[this.name]=e.Base.create("search-photos-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.searchId=t.searchId,this.apiParams={},this.searchTerm=t.searchTerm,this.apiFailed=t.apiFailed;var n=this.name.replace(/-/g,"_");return YUI.Env.isServer&&e.config.flickr.paft_metrics_samples&&e.config.flickr.paft_metrics_samples[n]&&(t.paft=!0),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,isSearchResults:!0},"filter-bar-neutered-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"search-photos-collection-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this,n,r,i=this.appContext.getViewer(),s;return i.signedIn?r=this.appContext.getModel("person-preferences-models",i.nsid):r=new e.AutoResolvingPromise,this.apiFailed?n=new e.AutoResolvingPromise:n=this.appContext.getModel("search-photos-models",this.searchId),s=e.batch(r,n),s.then(function(n){n[0]&&(t.personPreferencesModel=n[0]),n[1]?(t.searchModel=n[1],t.apiParams=t.searchModel.getValue("apiParams")):e.SearchHelper.addParamDefaults(t.apiParams,t.personPreferencesModel)}),s},buildContainer:function(){var e="",t="",n={apiFailed:!1,noQuery:!1,noMatchesForQuery:!1},r,i,s;return this.apiFailed?(n.apiFailed=!0,i=this.intlMessage({intlName:"search.SEARCH"}),t=this.subviews["filter-bar-neutered-view"].get("container")):this.searchModel.getValue("photos").getList().length?(e=this.subviews["search-photos-collection-view"].get("container"),t=this.subviews["filter-bar-neutered-view"].get("container")):this.searchModel.getValue("emptyQuery")?(n.noQuery=!0,i=this.intlMessage({intlName:"search.SEARCH_START"}),r=this.intlMessage({intlName:"search.BY_USER",user:"Gilles Couturier"})):(n.noMatchesForQuery=this.buildNoMatchesFoundMessage(),i=this.intlMessage({intlName:"search.SEARCH"}),t=this.subviews["filter-bar-neutered-view"].get("container")),s={"global-nav-view":this.subviews["global-nav-view"].get("container"),"filter-bar-neutered-view":t,"search-photos-collection-view":e,searchState:n,searchPlaceholder:i,flippers:this.appContext.flipper.toJSON(),"footer-full-view":this.subviews["footer-full-view"].get("container"),attribution:{link:"/photos/papy06/11384700923",by:r}},this.setContainerHTML(this.templates("search-photos-page")(s)),this},buildNoMatchesFoundMessage:function(){var t,n,r,i=this.appContext.getViewer();return n=this.searchModel.getValue("apiParams"),n.user_id?i.signedIn&&n.user_id===i.nsid?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR":r="search.NO_MATCHES_FOR_QUERY_TERM_YOUR":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER":r="search.NO_MATCHES_FOR_QUERY_TERM_USER":n.contacts?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS":r="search.NO_MATCHES_FOR_QUERY_TERM_CONTACTS":n.group_id?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP":r="search.NO_MATCHES_FOR_QUERY_TERM_GROUP":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM":r="search.NO_MATCHES_FOR_QUERY",this.searchTerm?t=this.intlMessage({intlName:r,searchTerm:e.flutil.unescape(this.searchTerm)}):t=this.intlMessage({intlName:r}),{noMatchesText:t}},activate:function(){var t=this,n;return this.registerEventHandler(this.subviews["filter-bar-neutered-view"].on("navigating",function(){var e=t.subviews["search-photos-collection-view"];e&&e.displayLoadingIndicator("searching")})),n=this.get("container").one("form.ui-large-search"),n&&this.registerEventHandler(n.on("submit",function(n){delete t.apiParams[e.SearchHelper.API.tags],t.apiParams[e.SearchHelper.API.text]=this.one("input").get("value"),e.SearchHelper.clearAdvancedSearchParams(t.apiParams),e.SearchHelper.addParamDefaults(t.apiParams,t.personPreferencesModel),t.appContext.flapp.navigate("/search/?"+e.QueryString.stringify(t.apiParams)),n.preventDefault()})),e.later(100,this,function(){t.appContext.flipper.isFlipped("enable-scrappy-photo-page")?e.use("photo-page-scrappy-view"):e.use("photo-page-view")}),this}},{ATTRS:{spaceid:{value:792600534}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","search-helper","hermes-template-search-photos-page","search-photos-page-css","search-photos-collection-view","display-collection-justified","flickrui-css","footer-full-view","filter-bar-neutered-view","querystring-stringify-simple"],optional:["search-photos-models"],langBundles:["search"]});
YUI.add("hermes-lang-client-app",function(e,t){e.Intl.add("hermes/client-app","en-US",{SAVING_LAST_ACTIONS:["Hey! We\u2019re still saving your last actions, you might lose them if you leave this page."]})},"@VERSION@",{requires:["intl"]});
