YUI.add("display-widget-fave",function(e){"use strict";var t,n=this.name,r=e.flutil;t=e.Base.create(n,e.Views["display-item"],[],{langBundles:this.details.langBundles,initializer:function(e){this.options=r.extend({templateName:"widget-fave"},e),this.set("photo",this.options.photo),this.processingFave=!1},initialize:function(){var e=this;this.appContext.getModel("photo-engagement-models",this.get("photo").id).then(function(t){e.set("photo-engagement",t),e.fire("activated"),e.render()})},toggleFave:function(t){var n=this,r=this.get("photo-engagement"),i=this.get("photo");t.halt(),r&&!this.processingFave&&(this.appContext.getViewer().signedIn?r.getValue("canFave")&&(this.processingFave=!0,r.registry.toggleFave(i.id),n.render(),r.remoteUpdate().then(function(){n.processingFave=!1},function(e){n.processingFave=!1,r.registry.toggleFave(i.id),n.render(),n.appContext.error(e.message)}),e.rapidTracker.beacon(this.name,"faveStarDisplayItemButtonClick")):this.promptTheUserToSignIn(i.id))},promptTheUserToSignIn:function(t){var n,r,i,s,o,u;i=this.intlMessage({intlName:"grease.YAY"}),s=this.intlMessage({intlName:"grease.JOIN_TO_FAVE_LINK",joinLink:"/signup/"}),u=this.intlMessage({intlName:"grease.SIGN_UP_TXT"}),o=this.intlMessage({intlName:"grease.SIGN_IN_TXT"}),n=new e.Views["confirmation-dialog-view"]({title:i,icon:"ui-icon-big-fave",content:s,confirmButtonClass:"ui-button-minimal",confirmButtonLabel:o,showAuxiliaryButton:!0,auxiliaryButtonLabel:u}),n.appContext=this.appContext,n.render(),n.activate(),n.on("auxiliaryClick",function(){window.location=e.url("/signup")}),r=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),r.show(),n.registerEventHandler(n.get("container").one(".ui-dialog-button-confirm").on("click",function(){r.close(),r.destroy(),e.SigninHelper.addPendingFave({id:t})}))},activate:function(){this.attachEvents({":fave":this.toggleFave})},render:function(){var e=this.get("photo-engagement"),t=e.getValue("faveCount");t?t>99?t="99+":t=t.toString():t="",this.buildContainer({faveCount:t,isFaved:e.getValue("isFaved"),isOwner:e.getValue("isOwner")})}}),e.namespace("Views")[n]=t},"@VERSION@",{requires:["flutil","display-item","dialog","signin-helper","confirmation-dialog-view","display-widget-fave-css","hermes-template-widget-fave","url"],langBundles:["grease"]});
YUI.add("hermes-lang-grease",function(e,t){e.Intl.add("hermes/grease","en-US",{JOIN_TO_FAVE:["You want to fave? Join Flickr!"],JOIN_TO_FAVE_LINK:['You want to fave? <a class="ui-join-link" data-action="follow" href="',"${joinLink}",'">Join Flickr!</a>'],JOIN_TO_COMMENT:["You want to comment? Join Flickr!"],JOIN_TO_COMMENT_LINK:['You want to comment? <a class="ui-join-link" data-action="follow" href="',"${joinLink}",'">Join Flickr!</a>'],JOIN_TO_EMAIL_STREAM:['You want to email this photostream? <a class="ui-join-link" data-action="follow" href="',"${joinLink}",'">Join Flickr!</a>'],JOIN_TO_SHARE_STREAM:['You want to share this photostream? <a class="ui-join-link" data-action="follow" href="',"${joinLink}",'">Join Flickr!</a>'],SIGN_IN_TO_COMMENT:["So you want to comment? Sign in and try again."],SIGN_IN_TO_FAVE:["So you want to fave? Sign in and try again."],SIGN_IN_TO_FAVE_BYE:["You must be signed in to fave. You will be redirected to signin now."],SIGN_IN_REQUIRED:["Sign in required"],OOPS:["Oops!"],YAY:["Yay!"],SIGN_UP:["Sign-up"],SIGN_IN:["Sign-in"],SIGN_UP_TXT:["Sign up"],SIGN_IN_TXT:["Sign in"],FORGET_IT:["Forget it"],NO:["No"],NO_THANKS:["No thanks"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-comment",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function d(e,t){var n="",r;return n+='\n			<img src="'+l((r=(r=(r=e.author,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r["default"]),typeof r===f?r.apply(e):r))+'" width="25" height="25">\n		',n}function v(e,t){var n="",r;return n+='\n			<img src="'+l((r=(r=e.author,r==null||r===!1?r:r.buddyicon),typeof r===f?r.apply(e):r))+'" width="25" height="25">\n		',n}function m(e,t){var r="",i;r+="\n				",i=n["if"].call(e,e.commentBelongsToViewer,{hash:{},inverse:c.program(12,E,t),fn:c.program(6,g,t),data:t});if(i||i===0)r+=i;r+="\n				",i=n["if"].call(e,e.canCommentBeDeleted,{hash:{},inverse:c.noop,fn:c.program(20,C,t),data:t});if(i||i===0)r+=i;return r+='\n				<a href="',(i=n.permalink)?i=i.call(e,{hash:{},data:t}):(i=e.permalink,i=typeof i===f?i.apply(e):i),r+=l(i)+'" class="comment-permalink ui-icon-comment-permalink" data-track="commentPermalinkClick" data-action="follow"></a>\n			',r}function g(e,t){var r="",i;r+="\n					",i=n["if"].call(e,e.noIcons,{hash:{},inverse:c.program(9,b,t),fn:c.program(7,y,t),data:t});if(i||i===0)r+=i;return r+="\n				",r}function y(e,t){return"\n					"}function b(e,t){var r="",i;r+="\n						",i=n["if"].call(e,e.enabledEditableComments,{hash:{},inverse:c.noop,fn:c.program(10,w,t),data:t});if(i||i===0)r+=i;return r+="\n					",r}function w(e,t){var r="",i;return r+='\n							<a href="#" class="comment-edit ui-icon-comment-edit" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-action="edit" title="Edit"></a>\n						',r}function E(e,t){var r="",i;r+="\n					",i=n["if"].call(e,e.canComment,{hash:{},inverse:c.noop,fn:c.program(13,S,t),data:t});if(i||i===0)r+=i;return r+="\n				",r}function S(e,t){var r="",i,s,o;r+='\n						<a href="#" class="comment-reply ',i=n["if"].call(e,e.noIcons,{hash:{},inverse:c.program(16,T,t),fn:c.program(14,x,t),data:t});if(i||i===0)r+=i;r+='" data-pathalias="'+l((i=(i=e.author,i==null||i===!1?i:i.pathAlias),typeof i===f?i.apply(e):i))+'" data-action="reply" title="Reply">',o={hash:{},inverse:c.noop,fn:c.program(18,N,t),data:t},(s=n.noIcons)?s=s.call(e,o):(s=e.noIcons,s=typeof s===f?s.apply(e):s),n.noIcons||(s=h.call(e,s,o));if(s||s===0)r+=s;return r+="</a>\n					",r}function x(e,t){var n="";return n}function T(e,t){return"ui-icon-comment-reply"}function N(e,t){return"Reply"}function C(e,t){var r="",i;return r+='\n					<a href="#" class="comment-delete ui-icon-comment-delete" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-action="delete" title="Delete"></a>\n				',r}function k(e,t){var r="",i,s;return r+='\n        <div class="comment-content">',s={hash:{},data:t},r+=l((i=n.renderSafeInlineComment||e.renderSafeInlineComment,i?i.call(e,e.contentSecure,e.ellipsis,s):p.call(e,"renderSafeInlineComment",e.contentSecure,e.ellipsis,s)))+"</div>\n	",r}function L(e,t){var r="",i,s;return r+='\n        <div class="comment-content">',s={hash:{},data:t},r+=l((i=n.renderTrustedMarkupWithLineBreaks||e.renderTrustedMarkupWithLineBreaks,i?i.call(e,e.contentSecure,s):p.call(e,"renderTrustedMarkupWithLineBreaks",e.contentSecure,s)))+"</div>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.blockHelperMissing,p=n.helperMissing;s+='<li class="comment" id="',a={hash:{},data:i},s+=l((o=n.commentPermalinkId||t.commentPermalinkId,o?o.call(t,t.id,a):p.call(t,"commentPermalinkId",t.id,a)))+'">\n	<div class="comment-icon circle-icon">\n		<a href="/photos/'+l((o=(o=t.author,o==null||o===!1?o:o.pathAlias),typeof o===f?o.apply(t):o))+'/" data-track="commentBuddyIconClick" data-action="follow">\n		',u=n["if"].call(t,(o=(o=t.author,o==null||o===!1?o:o.buddyicon),o==null||o===!1?o:o["default"]),{hash:{},inverse:c.program(3,v,i),fn:c.program(1,d,i),data:i});if(u||u===0)s+=u;s+='\n		</a>\n	</div>\n	<p class="comment-author">\n		<a href="/photos/'+l((o=(o=t.author,o==null||o===!1?o:o.pathAlias),typeof o===f?o.apply(t):o))+'/" data-track="commentUserNameClick" data-action="follow">\n			',a={hash:{},data:i},s+=l((o=n.truncate||t.truncate,o?o.call(t,(o=t.author,o==null||o===!1?o:o.displayname),20,a):p.call(t,"truncate",(o=t.author,o==null||o===!1?o:o.displayname),20,a)))+'\n		</a>\n		<span class="comment-actions">\n			',u=n["if"].call(t,t.isSignedIn,{hash:{},inverse:c.noop,fn:c.program(5,m,i),data:i});if(u||u===0)s+=u;s+='\n		</span>\n	</p>\n	<div class="comment-date">',(u=n.timeago)?u=u.call(t,{hash:{},data:i}):(u=t.timeago,u=typeof u===f?u.apply(t):u),s+=l(u)+"</div>\n	",u=n["if"].call(t,t.isTooltipComment,{hash:{},inverse:c.program(24,L,i),fn:c.program(22,k,i),data:i});if(u||u===0)s+=u;return s+="\n</li>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comment",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-comments",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function u(e,t){var r="",i;r+="\n	<ul class='comments'>\n		",i=n.each.call(e,e.comments,{hash:{},inverse:o.noop,fn:o.program(2,a,t),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n",r}function a(e,t){var i="",s;i+="\n			",s=o.invokePartial(r.comment,"comment",e,n,r,t);if(s||s===0)i+=s;return i+="\n		",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s,o=this;return s=n["if"].call(t,t.comments,{hash:{},inverse:o.noop,fn:o.program(1,u,i),data:i}),s||s===0?s:""}),r={};e.Array.each(["comment"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comments",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-comment"]});
YUI.add("hermes-template-comment-form",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\n		<div class="comment-icon circle-icon">\n			',s=n["if"].call(e,(i=(i=e.user,i==null||i===!1?i:i.buddyicon),i==null||i===!1?i:i.medium),{hash:{},inverse:f.program(4,h,t),fn:f.program(2,c,t),data:t});if(s||s===0)r+=s;return r+='\n		</div>\n		<div class="comment-form-field">\n			<textarea class="new-comment-text" name="comment" placeholder="Add a comment" data-notutorial="Add a comment" data-tutorial="press Enter to post and Shift+Enter for newline" data-action="comment"></textarea>\n			<textarea class="false-comment-content"></textarea>\n		</div>\n	',r}function c(e,t){var n="",r;return n+='\n				<img src="'+a((r=(r=(r=e.user,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r.medium),typeof r===u?r.apply(e):r))+'" width="25" height="25" />\n			',n}function h(e,t){var n="",r;return n+='\n				<img src="'+a((r=(r=(r=e.user,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r["default"]),typeof r===u?r.apply(e):r))+'" width="25" height="25" />\n			',n}function p(e,t){return'\n		<div class="comment-form-field is-logged-out">\n			<a href="#"></a>\n			<textarea name="comment" disabled placeholder="You must be signed in to post a comment" data-action="comment"></textarea>\n		</div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="comments-form">\n	',o=n["if"].call(t,t.user,{hash:{},inverse:f.program(6,p,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comment-form",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-comments-view",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){return'\n	<div class=\'loadingError\'>\n		<p>Error loading comments</p>\n		<p><button href="#" class="ui-button ui-button-cta ui-button-transparent retry">Retry</button></p>\n	</div>\n'}function l(e,t){var r="",i;r+="\n	<div class='comments-holder order-",(i=n.commentsOrder)?i=i.call(e,{hash:{},data:t}):(i=e.commentsOrder,i=typeof i===o?i.apply(e):i),r+=u(i)+" ",(i=n.photosInCommentsClass)?i=i.call(e,{hash:{},data:t}):(i=e.photosInCommentsClass,i=typeof i===o?i.apply(e):i),r+=u(i)+"'>\n		",i=n["if"].call(e,e.commentsChronological,{hash:{},inverse:a.program(12,m,t),fn:a.program(4,c,t),data:t});if(i||i===0)r+=i;return r+="\n	</div>\n",r}function c(e,t){var i="",s;i+="\n			",s=n["if"].call(e,e.showMore,{hash:{},inverse:a.noop,fn:a.program(5,h,t),data:t});if(s||s===0)i+=s;i+="\n			",s=a.invokePartial(r.comments,"comments",e,n,r,t);if(s||s===0)i+=s;i+="\n			",s=n["if"].call(e,e.canComment,{hash:{},inverse:a.noop,fn:a.program(10,v,t),data:t});if(s||s===0)i+=s;return i+="\n		",i}function h(e,t){var r="",i;r+="\n				<div class='comments-more'>\n					<i class=\"ui-icon-comments\"></i>\n					",i=n["if"].call(e,e.isTooltipComments,{hash:{},inverse:a.program(8,d,t),fn:a.program(6,p,t),data:t});if(i||i===0)r+=i;return r+="\n				</div>\n			",r}function p(e,t){var r="",i;return r+='\n                        <a href="',(i=n.photoUrl)?i=i.call(e,{hash:{},data:t}):(i=e.photoUrl,i=typeof i===o?i.apply(e):i),r+=u(i)+'" data-action="follow" >',(i=n.showMoreString)?i=i.call(e,{hash:{},data:t}):(i=e.showMoreString,i=typeof i===o?i.apply(e):i),r+=u(i)+"</a>\n					",r}function d(e,t){var r="",i;return r+="\n                        <a href='#'>",(i=n.showMoreString)?i=i.call(e,{hash:{},data:t}):(i=e.showMoreString,i=typeof i===o?i.apply(e):i),r+=u(i)+"</a>\n					",r}function v(e,t){var i="",s;i+="\n				",s=a.invokePartial(r["comment-form"],"comment-form",e,n,r,t);if(s||s===0)i+=s;return i+="\n			",i}function m(e,t){var i="",s;i+="\n			",s=n["if"].call(e,e.canComment,{hash:{},inverse:a.noop,fn:a.program(10,v,t),data:t});if(s||s===0)i+=s;i+="\n			",s=a.invokePartial(r.comments,"comments",e,n,r,t);if(s||s===0)i+=s;i+="\n			",s=n["if"].call(e,e.showMore,{hash:{},inverse:a.noop,fn:a.program(13,g,t),data:t});if(s||s===0)i+=s;return i+="\n		",i}function g(e,t){var r="",i;return r+="\n				<div class='comments-more'><a href='#'>",(i=n.showMoreCount)?i=i.call(e,{hash:{},data:t}):(i=e.showMoreCount,i=typeof i===o?i.apply(e):i),r+=u(i)+" more</a></div>\n			",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n["if"].call(t,t.loadingError,{hash:{},inverse:a.program(3,l,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each(["comments","comment-form","comment-form","comments"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comments-view",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-comments","hermes-template-comment-form","hermes-template-comment-form","hermes-template-comments"]});
YUI.add("flickr-photos-comments-addComment-creator",function(e){"use strict";function t(e){var t={extras:"icon_urls"};return t.photo_id=e.photoId,t.comment_text=e.commentText,t.expand_bbml=!0,t.use_text_for_links=1,t.secure_image_embeds=1,e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(t){var n=t[0],r=t[1],i=t[2],s={id:n.comment.author,username:n.comment.authorname,pathAlias:n.comment.pathAlias,realname:n.comment.realname,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(n.comment.iconurls),isPro:n.comment.ispro,isAdFree:n.comment.isAdFree},o=r.exists(n.comment.author)?r.proxy(n.comment.author):r.add(s);return i.add({id:n.comment.id,author:o,date:n.comment.datecreate,permalink:n.comment.permalink,content:n.comment.content,contentRaw:n.comment.rawComment.content,contentSecure:n.comment.secureComment.content})}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.addComment",this._processParams(t)),n.getModelRegistry("person-models"),n.getModelRegistry("comment-models")).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-addComment-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photos-comments-addComment"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-photos-comments-editComment-updater",function(e){"use strict";function t(e){var t={extras:"icon_urls"};return t.comment_id=e.commentId,t.comment_text=e.content,t.expand_bbml=!0,t.full_result=1,t.use_text_for_links=1,t.secure_image_embeds=1,e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(e){var t=e[0],n=e[1];return n.setValues({content:t.comment.content,contentRaw:t.comment.rawComment.content,contentSecure:t.comment.secureComment.content}),n}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.editComment",this._processParams(t)),n.getModel("comment-models",t.commentId)).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-editComment-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-photos-comments-editComment"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-photos-comments-deleteComment-deletor",function(e){"use strict";function t(e,t){var n={};return n.comment_id=e,t.callAPI("flickr.photos.comments.deleteComment",n).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-photos-comments-deleteComment-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelDeletors")["flickr-photos-comments-deleteComment"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("comment-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-comments-addComment"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-photos-comments-editComment"].run({commentId:t,content:n.content.newVal,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")},this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-comments-deleteComment"].run(t,this.appContext)}},attributes:{author:{isModel:!0},date:{},timeago:{readOnly:!0,derivedBy:["date"],getter:function(t,n){return e.moment.unix(this.getValue(n,"date")).fromNow()}},permalink:{},content:{},contentSecure:{},contentRaw:{}}})},"@VERSION@",{requires:["flickr-model-registry","moment","flickr-photos-comments-addComment-creator","flickr-photos-comments-editComment-updater","flickr-photos-comments-deleteComment-deletor"]});
YUI.add("photo-comments-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{comments:{isListProxy:!0,rangeFetch:{listFetcher:e.ListFetchers["flickr-photos-comments-getList"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-comments-getList-fetcher"]});
YUI.add("flickr-photos-comments-getList-fetcher",function(e){"use strict";function t(e){var t={photo_id:e.id,offset:e.offset||0,limit:e.limit||4,sort:e.sort||"date-posted-desc",extras:"icon_urls",expand_bbml:!0,use_text_for_links:1,secure_image_embeds:1};return e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=[],u=typeof n.comments.comment=="undefined"?0:n.comments.comment.length,a,f,l,c,h;return u>0&&e.Array.each(n.comments.comment,function(t,n,r){a={id:t.author,username:t.authorname,realname:t.realname,pathAlias:t.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(t.iconurls),isAdFree:t.isAdFree,isPro:t.ispro},a.pathAlias=t.pathAlias,l=s.exists(t.author)?s.proxy(t.author):s.add(a),f={id:t.id,author:l,date:t.datecreate,permalink:t.permalink,content:t.content,contentRaw:t.rawComment.content,contentSecure:t.secureComment.content},o.push(i.exists(t.id)?i.proxy(t.id):i.add(f))}),r.exists(n.comments.photoId)?(c=r.proxy(n.comments.photoId).getValue("comments").getList(),h=c.concat(o),r.proxy(n.comments.photoId).setValue("comments",h)):r.add({id:n.comments.photoId,comments:o}),o}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.getList",this._processParams(t)),n.getModelRegistry("photo-comments-models"),n.getModelRegistry("comment-models"),n.getModelRegistry("person-models")).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photos-comments-getList"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-comments-models","comment-models","person-models"]});
YUI.add("comments-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.appContext.flipper.isFlipped("comments-chronological")?(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:3,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:200):(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:4,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:10),this.isTooltipComments=e.isTooltipComments?!0:!1,this.currentlyShowingCount=0,this.initiallyShowingCount=0,this.textAreaMaxHeight=180,this.textAreaMinHeight=35,this.textAreaUserSetHeight=this.textAreaMinHeight,this.noIcons=e.noIcons,this.postingComment=!1,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelsRegistry=e})),n.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(n){t.photoEngagement=n;var r=t.photoEngagement.getValue("commentCount"),i=e.config.win.location.hash,s=/#comment{1}/g;i&&s.test(i)?(t.initiallyShowingCount=r,t.currentlyShowingCount=r):r>=t.initiallyShowingMaximum?(t.initiallyShowingCount=t.initiallyShowingMaximum,t.currentlyShowingCount=t.initiallyShowingMaximum):(t.initiallyShowingCount=r,t.currentlyShowingCount=r)}).then(function(){return t.appContext.getModel("photo-comments-models",t.photoId)}).then(function(e){t.photoComments=e;if(t.photoEngagement.getValue("commentCount")>0)return t.photoComments.getValue("comments").getRange({offset:0,limit:t.initiallyShowingCount,photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){t.set("comments",e)});t.set("comments",[])})),n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.photoModel=e})),this.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.person=e})),e.batch.apply(null,n)},buildContainer:function(){var t,n=this.photoModel.getValue("url"),r=this.person?this.person.toJSON():null,i=this.get("comments"),s=this.appContext.flipper.isFlipped("comments-chronological")?"chronological":"reverse-chronological",o=this.calculateShowMoreCount(),u=o===1?"1 more comment":o+" more comments",a,f=e.config.win.location.hash,l=/#comment{1}/g;this.appContext.flipper.isFlipped("comments-chronological")&&(i=i.reverse()),this.isTooltipComments&&(this.ellipsis=this.intlMessage({intlName:"comments.SEE_MORE_LINK",photoUrl:n}));for(a=0;a<i.length;a++)i[a]=i[a].toJSON?i[a].toJSON():i[a],i[a].isSignedIn=this.appContext.getViewer().signedIn,i[a].isLoggedInUsersPhoto=this.isLoggedInUsersPhoto(),i[a].canCommentBeDeleted=this.canCommentBeDeleted(i[a].author.nsid),i[a].commentBelongsToViewer=this.commentBelongsToViewer(i[a].author.nsid),i[a].enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i[a].canComment=this.photoModel.getValue("canComment"),i[a].isTooltipComment=this.isTooltipComments,i[a].ellipsis=this.ellipsis,i[a].noIcons=this.noIcons;return t=this.templates("comments-view")({user:r,comments:i,showMore:this.calculateShowMoreCount()>0?!0:!1,showMoreCount:this.calculateShowMoreCount(),showMoreString:u,canComment:this.photoModel.getValue("canComment"),tutorialMode:!0,isTooltipComments:this.isTooltipComments,photoUrl:n,commentsOrder:s,commentsChronological:this.appContext.flipper.isFlipped("comments-chronological"),photosInCommentsClass:this.appContext.flipper.isFlipped("photos-in-comments")?"photosInComments":""}),this.setContainerHTML(t),this.retinafyCommentImages(),f&&l.test(f)&&this.jumpToPermalinkedComment(),this},buildErrorContainer:function(){this.setContainerHTML(this.templates("comments-view")({loadingError:!0}))},activate:function(){var t=this,n=t.get("container").one(".new-comment-text");return t.get("container").one(".comments-more")&&t.registerEventHandler(t.get("container").one(".comments-more a").on("click",t.handleMoreCommentsClick.bind(t))),e.use("transition",function(e){t.attachEvents({"keydown:comment":t.handleCommentKeyDown.bind(t),"blur:comment":t.handleCommentBlur.bind(t),"focus:comment":t.handleCommentFocus.bind(t),"mouseup:comment":t.handleCommentMouseUp.bind(t),"mouseleave:comment":t.handleCommentMouseLeave.bind(t),"mousedown:comment":t.handleCommentMouseDown.bind(t),".comment-reply click:reply":t.handleReplyClick.bind(t),".comment-delete click:delete":t.handleDeleteClick.bind(t),".comment-edit click:edit":t.handleEditClick.bind(t)})}),n&&n.setStyles({minHeight:this.textAreaMinHeight+"px",maxHeight:this.textAreaMaxHeight+"px"}),this},postComment:function(t){var n=this,r,i,s,o,u=this.photoEngagement.getValue("commentCount");n.fire("addingNewComment");if(e.Lang.trim(t)===""){this.onError("An empty comment box? That won't work!"),this.postingComment=!1;return}e.rapidTracker.beacon(this.name,"commentPosted"),this.commentModelsRegistry.remoteCreate({photoId:this.photoId,commentText:t,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")}).then(function(t){i=t.toJSON(),i.isSignedIn=n.appContext.getViewer().signedIn,i.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),i.enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i.canCommentBeDeleted=!0,i.commentBelongsToViewer=!0,i.canComment=!0,n.get("container").one(".new-comment-text").set("value","").setStyle("height",n.textAreaMinHeight+"px"),r=e.Node.create(n.templates("comment")(i)).setStyle("opacity","0.1"),u>0?n.appContext.flipper.isFlipped("comments-chronological")?n.get("container").one(".comments").append(r).one("li:last-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):n.get("container").one(".comments").prepend(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):(n.appContext.flipper.isFlipped("comments-chronological"
)?n.get("container").one(".comments-holder").prepend("<ul class='comments'></ul>"):n.get("container").one(".comments-holder").append("<ul class='comments'></ul>"),n.get("container").one(".comments").append(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"})),n.retinafyCommentImages(),s=n.photoComments.getValue("comments").prependToList(t),o=n.photoEngagement.getValue("commentCount")+1,n.photoEngagement.setValue("commentCount",o),n.currentlyShowingCount++,n.fire("newCommentAdded"),n.postingComment=!1},function(e){e.code===409?n.onError("Slow down, partner! To protect the Flickr community against spam and spammy behavior we place a few restrictions on commenting."):e.code===8?n.onError("An empty comment box? That won't work!"):n.onError("We couldn't post your comment."),n.postingComment=!1}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})},handleMoreCommentsClick:function(e){e.preventDefault();var t=this,n=this.get("container"),r="",i=n.one(".comments-more"),s;i.one("a").set("text","Loading"),i.addClass("is-loading"),this.appContext.getModel("photo-comments-models",this.photoId).then(function(e){e.getValue("comments").getRange({offset:t.currentlyShowingCount,limit:t.calculateShowMoreCount(),photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){var o;t.appContext.flipper.isFlipped("comments-chronological")&&(e=e.reverse());for(o=0;o<e.length;o++)s=e[o].toJSON(),s.isSignedIn=t.appContext.getViewer().signedIn,s.isLoggedInUsersPhoto=t.isLoggedInUsersPhoto(),s.canCommentBeDeleted=t.canCommentBeDeleted(s.author.nsid),s.commentBelongsToViewer=t.commentBelongsToViewer(s.author.nsid),s.enabledEditableComments=t.appContext.flipper.isFlipped("enable-editable-comments"),s.canComment=t.photoModel.getValue("canComment"),r+=t.templates("comment")(s);t.appContext.flipper.isFlipped("comments-chronological")?n.one(".comments").prepend(r):n.one(".comments").append(r),t.retinafyCommentImages(),t.currentlyShowingCount=t.currentlyShowingCount+e.length,t.calculateShowMoreCount()>0?(i.one("a").set("text",t.calculateShowMoreCount()+" more"),i.removeClass("is-loading")):i.remove()},function(e){t.onError("We couldn't get more comments.")}).then(null,function(e){t.appContext.error(e.message),t.appContext.error(e.stack)})})},calculateShowMoreCount:function(){var e=this.photoEngagement.getValue("commentCount");return e>this.currentlyShowingCount+this.showMoreMaximum?this.showMoreMaximum:e<=this.currentlyShowingCount+this.showMoreMaximum?e-this.currentlyShowingCount:0},isLoggedInUsersPhoto:function(){return this.photoModel.getValue("owner").getValue("nsid")===this.appContext.getViewer().nsid},canCommentBeDeleted:function(e){return e===this.appContext.getViewer().nsid||this.isLoggedInUsersPhoto()?!0:!1},commentBelongsToViewer:function(e){return e===this.appContext.getViewer().nsid?!0:!1},jumpToPermalinkedComment:function(){var t=e.config.win.location.hash,n=this.get("container"),r,i=this,s;r=n.one(t),r?(r.scrollIntoView(!0),r.addClass("permalinked-comment")):i.fire("viewEvent","getDialogOffset",function(t){s=e.Views.dialog.getNewInstance("dialog-alert",{content:"We were unable to find the specified comment in the Photo.",attrs:{title:"Oops!",level:"warning",confirmLabel:"OK"},parent:i,offsetLeft:t}),s.show()})},retinafyCommentImages:function(){if(this.appContext.getCookie("density")>1){var t=e.all(".comments li .comment-content a[data-photo-size-m]");t.each(function(e){e.one("img").setAttribute("src",e.getAttribute("data-photo-size-m")),e.removeAttribute("data-photo-size-m")})}},handleCommentKeyDown:function(e){var t=this,n=this.get("container").one(".new-comment-text"),r=n.get("value"),i=this.get("container").one(".false-comment-content"),s;if(e.charCode===13&&!e.altKey&&!e.shiftKey&&!this.postingComment){this.textAreaUserSetHeight=this.textAreaMinHeight,e.preventDefault(),this.postingComment=!0,this.postComment(r);return}setTimeout(function(){i.set("value",n.get("value")),s=i._node.scrollHeight<t.textAreaMinHeight?t.textAreaMinHeight:i._node.scrollHeight,s=i._node.scrollHeight>t.textAreaMaxHeight?t.textAreaMaxHeight:s,s=t.textAreaUserSetHeight>i._node.scrollHeight?t.textAreaUserSetHeight:s,n.setStyle("height",s+"px")},10)},handleCommentMouseDown:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=t.getComputedStyle("height"),isNaN(n)||(this.textAreaUserSetHeight=this.textAreaUserSetHeight!==n?n:this.textAreaUserSetHeight))},handleCommentMouseUp:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=parseInt(t.getComputedStyle("height"),10),!isNaN(n)&&this.textAreaUserSetHeight!==n&&(this.textAreaUserSetHeight=n>this.textAreaMaxHeight?this.textAreaMaxHeight:n,t.setStyle("height",this.textAreaUserSetHeight+"px")))},handleCommentMouseLeave:function(t){e.config.win.clearTimeout(this.textAreaUserMouseLeave),this.textAreaUserMouseLeave=setTimeout(e.bind(function(){var e=this.get("container").one(".new-comment-text"),t=0;e&&(t=parseInt(e.getComputedStyle("height"),10),isNaN(t)||(this.textAreaUserSetHeight=t<this.textAreaMinHeight?this.textAreaMinHeight:t,this.textAreaUserSetHeight=t>this.textAreaMaxHeight?this.textAreaMaxHeight:t))},this),100)},handleCommentBlur:function(e){var t=this.get("container").one("textarea");t.getData("notutorial")&&t.set("placeholder",t.getData("notutorial"))},handleCommentFocus:function(e){var t=this.get("container").one("textarea");t.getData("tutorial")&&t.set("placeholder",t.getData("tutorial"))},handleReplyClick:function(t){t.preventDefault();var n=this.get("container").one("textarea"),r=n.get("value"),i="",s=n.getDOMNode(),o;r.length>0&&(i+=r+" "),i+="["+e.url("/photos/"+t.target.getAttribute("data-pathalias"))+"] ",s.setSelectionRange?(s.focus(),s.setSelectionRange(s.value.length,s.value.length)):s.createTextRange&&(o=s.createTextRange(),o.collapse(!0),o.moveEnd("character",s.value.length),o.moveStart("character",s.value.length),o.select()),n.focus()
,n.set("value",i),s.scrollTop=s.scrollHeight},handleEditClick:function(t){t.preventDefault();var n=this,r=t.target.ancestor(".comment"),i=t.target.getAttribute("data-id"),s,o,u,a=this.get("container").one(".false-comment-content"),f;if(r.one("textarea")){r.one("textarea").remove(),r.one(".comment-content").show();return}n.appContext.getModel("comment-models",i).then(function(t){r.one(".comment-content").hide(),n.appContext.flipper.isFlipped("photos-in-comments")?r.append("<textarea>"+t.getValue("contentRaw")+"</textarea>"):r.append("<textarea>"+t.getValue("content")+"</textarea>"),s=r.one("textarea"),a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px"),s.select(),s.on("keydown",function(l){setTimeout(function(){a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px")},10);if(l.charCode===13&&!l.altKey&&!l.shiftKey&&!n.postingEditedComment){l.preventDefault();if(e.Lang.trim(s.get("value"))===""){n.onError("An empty comment box? That won't work!");return}n.postingEditedComment=!0,t.setValues({content:s.get("value")}),n.appContext.modelRegistries["comment-models"].remoteUpdate(i).then(function(i){i?u=i.toJSON():u=t.toJSON(),u.isSignedIn=n.appContext.getViewer().signedIn,u.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),u.enabledEditableComments=n.appContext.flipper.isFlipped("enable-editable-comments"),u.canCommentBeDeleted=!0,u.commentBelongsToViewer=!0,u.canComment=n.photoModel.getValue("canComment"),u.isTooltipComment=n.isTooltipComments,u.ellipsis=n.ellipsis,o=e.Node.create(n.templates("comment")(u)),r.replace(o),n.fire("commentEdited"),n.postingEditedComment=!1},function(e){n.postingEditedComment=!1,t.revertValue("content"),n.onError(e.message)})}})})},handleDeleteClick:function(t){t.preventDefault();var n=this,r,i,s=t.target.ancestor(".comment"),o=t.target.getAttribute("data-id"),u;r=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:"Delete Comment",icon:"ui-icon-modal-warning",content:"Are you sure you want to delete this comment?",confirmButtonLabel:"Delete"}),r.render(),r.activate(),i=r.get("container"),r.registerEventHandler(i.one(".ui-dialog-button-confirm").on("click",function(){n.commentingDialog.close(),n.commentingDialog.destroy(),n.appContext.modelRegistries["comment-models"].remoteDelete(o).then(function(){n.photoComments.getValue("comments").removeFromList(o),u=n.photoEngagement.getValue("commentCount")-1,n.photoEngagement.setValue("commentCount",u),n.currentlyShowingCount--,n.fire("commentDeleted"),s.transition({easing:"ease-out",duration:.5,opacity:"0"},function(){s.remove(),u===0&&n.get("container").one(".comments").remove()})},function(e){n.onError("We couldn't delete your comment.")}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})})),this.fire("subviewViewEvent","getDialogOffset",function(t){n.commentingDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:r.get("container"),appContext:n.appContext,offsetLeft:t}),n.commentingDialog.show()})},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getNewInstance("dialog-alert",{content:t,attrs:{title:"Error",level:"warning",confirmLabel:"OK"},parent:n,offsetLeft:r});i.show()})}})},"@VERSION@",{requires:["dialog","flickr-view","moment","comments-css","hermes-template-comments","hermes-template-comment","hermes-template-comments-view","url"],langBundles:["comments"],optional:["photo-comments-models"]});
YUI.add("hermes-lang-comments",function(e,t){e.Intl.add("hermes/comments","en-US",{LOADING:["Loading"],MORE:["more"],ERROR_LOADING_COMMENTS:["Error loading comments"],COULDNT_POST_COMMENT:["We couldn't post your comment"],COULDNT_GET_MORE_COMMENTS:["We couldn't get more comments"],CONFIRM_DELETE:["Confirm Delete"],YES_CONFIRM_DELETE:["Yes, Delete It"],ARE_YOU_SURE_DELETE:["Are you sure you want to delete this comment?"],COULDNT_DELETE_COMMENT:["We couldn't delete your comment"],ERROR:["Error!"],NO_COMMENTS:["No comments"],ADD_A_COMMENT:["Add a comment"],MUST_BE_LOGGED_IN_TO_COMMENT:["You must be logged in to post a comment"],LOADING_COMMENTS:["Loading comments..."],SEE_MORE:["See more"],SEE_MORE_LINK:['... <a href="',"${photoUrl}",'">Read more</a>']})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-widget-comment",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="ui-display-widget-comment">\n	<span class="ui-link" data-action="getcomments">\n		<span class="ui-icon-comments"></span>\n		<span class="comment-counter">',(o=n.commentCount)?o=o.call(t,{hash:{},data:i}):(o=t.commentCount,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n	</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/widget-comment",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("display-widget-comment",function(e){"use strict";var t,n=this.name,r=e.flutil;t=e.Base.create(n,e.Views["display-item"],[],{langBundles:this.details.langBundles,initializer:function(t){this.options=r.extend({templateName:"widget-comment"},t),this.set("photo",this.options.photo),this.CommentsView=e.namespace("Views")["comments-view"]},initialize:function(){var e=this;this.appContext.getModel("photo-engagement-models",this.get("photo").id).then(function(t){e.set("photo-engagement",t),e.fire("activated"),e.render()})},showCommentDialog:function(t){var n=this,r=this.get("photo"),i=new this.CommentsView({appContext:this.appContext,isTooltipComments:!0,photoId:r.id,noIcons:!0}),s,o;t.preventDefault(),this.appContext.getViewer().signedIn?(this.target=this.target||t.target.hasClass("ui-link")?t.target:t.target.ancestor(".ui-link"),this.target&&(e.rapidTracker.beacon(this.name,"commentDisplayItemButtonClick"),this.target.addClass("ui-state-fetching"),i.initialize().then(function(t){s=n.target.ancestor(".ui-display-wrapper"),o=e.Views.dialog.getInstance("dialog-tooltip",{content:i.get("container"),appendCurtainTo:n.get("container").ancestor(".ui-display-wrapper").get("parentNode"),anchorTo:n.target,positioning:!0,constraints:{top:90},parent:n,arrow:!0,id:n.getId()}),n.setEnvironmentToShowInlineComment(s,o),o.on("hide",function(){n.cleanEnvironmentAfterShowingInlineComment(s)}),n.convertCommentsIntoInlineComments(i),i.on("addingNewComment",function(){e.Views.dialog.close(),n.target.addClass("ui-state-fetching")}),i.on("newCommentAdded",function(){n.target.removeClass("ui-state-fetching"),n.updateCounter(),n.convertCommentsIntoInlineComments(i)}),i.on("commentEdited",function(){n.convertCommentsIntoInlineComments(i)}),i.on("commentDeleted",function(){n.updateCounter()}),o.show(),i.render(),n.target.removeClass("ui-state-fetching"),i.activate()}))):n.promptTheUserToSignIn(r.id)},promptTheUserToSignIn:function(t){var n,r,i,s,o,u;i=this.intlMessage({intlName:"grease.YAY"}),s=this.intlMessage({intlName:"grease.JOIN_TO_COMMENT_LINK",joinLink:"/signup/"}),u=this.intlMessage({intlName:"grease.SIGN_UP_TXT"}),o=this.intlMessage({intlName:"grease.SIGN_IN_TXT"}),n=new e.Views["confirmation-dialog-view"]({title:i,icon:"ui-icon-big-comment",content:s,confirmButtonClass:"ui-button-minimal",confirmButtonLabel:o,showAuxiliaryButton:!0,auxiliaryButtonLabel:u}),n.appContext=this.appContext,n.render(),n.activate(),n.on("auxiliaryClick",function(){window.location=e.url("/signup")}),r=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),r.show(),n.registerEventHandler(n.get("container").one(".ui-dialog-button-confirm").on("click",function(){r.close(),r.destroy(),e.SigninHelper.addPendingComment({id:t})}))},updateCounter:function(){this.render()},convertCommentsIntoInlineComments:function(e){var t=e.get("container");t.all(".comment-content a").each(function(e){e.setAttribute("data-action","follow")}),t.all(".comment-content img").each(function(e){e.remove()})},setEnvironmentToShowInlineComment:function(e,t){var n=e.one(".ui-display-shield");e.addClass("ui-state-inline-commenting"),this.shieldClickSubscription=n.on("click",function(e){e.halt(),t.close()})},cleanEnvironmentAfterShowingInlineComment:function(e){e.removeClass("ui-state-inline-commenting"),this.shieldClickSubscription&&this.shieldClickSubscription.detach(),this.shieldClickSubscription=null},activate:function(){this.attachEvents({":getcomments":this.showCommentDialog})},render:function(){var e=this.get("photo-engagement"),t=e.getValue("commentCount");t?t>99?t="99+":t=t.toString():t="",this.buildContainer({commentCount:t})}}),e.namespace("Views")[n]=t},"@VERSION@",{requires:["flutil","dialog","display-item","comments-view","dialog","signin-helper","display-widget-comment-css","confirmation-dialog-view","hermes-template-widget-comment","url"],langBundles:["grease"]});
YUI.add("hermes-template-widget-meta",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="ui-display-widget-meta">\n	<span class="title">\n		<a href="',(o=n.photoUrl)?o=o.call(t,{hash:{},data:i}):(o=t.photoUrl,o=typeof o===a?o.apply(t):o),s+=f(o)+'" title="',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===a?o.apply(t):o),s+=f(o)+'">',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===a?o.apply(t):o),s+=f(o)+'</a>\n	</span>\n	<span class="attribution">\n		',u={hash:{intlName:"widget-meta.BY_LINK",userUrl:t.userUrl,displayName:t.displayName,displayName:t.displayName},data:i},s+=f((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,u):l.call(t,"intlHTMLMessage",u)))+"\n	</span>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/widget-meta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("display-widget-meta",function(e){"use strict";var t,n=this.name,r=e.flutil;t=e.Base.create(n,e.Views["display-item"],[],{langBundles:this.details.langBundles,initializer:function(e){this.options=r.extend({templateName:"widget-meta"},e),this.photo=this.options.photo},initialize:function(){var e=this.photo,t=e.getValue("owner"),n,r;e.getValue("isOwner")?n=this.intlMessage({intlName:"widget-meta.YOU"}):n=t.getValue("displayname"),r={title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),photoUrl:e.getValue("url"),displayName:n,userUrl:t.getValue("url")},this.render(r)},activate:function(){},render:function(e){this.buildContainer(e)}}),e.namespace("Views")[n]=t},"@VERSION@",{requires:["flutil","display-item","display-widget-meta-css","hermes-template-widget-meta"],langBundles:["widget-meta","default"]});
YUI.add("hermes-lang-widget-meta",function(e,t){e.Intl.add("hermes/widget-meta","en-US",{BY_LINK:['by <a href="',"${userUrl}",'" title="',"${displayName}",'">',"${displayName}","</a>"],YOU:["YOU!"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-default",function(e,t){e.Intl.add("hermes/default","en-US",{UNTITLED:["Untitled"]})},"@VERSION@",{requires:["intl"]});
YUI.add("display-item-tile",function(e){"use strict";var t,n=this.name,r=e.flutil,i=e.Flog;t=e.Base.create(n,e.Views["display-item"],[],{langBundles:this.details.langBundles,initializer:function(t){this.options=r.extend({templateName:"display-item-tile"},t),this.subviews={},this.photo=null,this.assetManager=null,this.bleedWidth=0,this.bleedHeight=0,this.frameWidth=0,this.frameHeight=0,this._style={},this._el={},this.photo=this.options.photo||null;if(this.options.disableFave||this.options.disableMeta||this.options.disableComments)this.subviewConfig=[],this.options.disableFave||this.subviewConfig.push("display-widget-fave"),this.options.disableMeta||this.subviewConfig.push("display-widget-meta"),this.options.disableComments||this.subviewConfig.push("display-widget-comment");return this.photo&&(this.assetManager=new e.AssetManager(this.photo,{maxUpSampleAmount:.05,container:this.get("container"),selector:".ui-display-image",normalizeAspect:!0})),this.paft=t.paft,this},subviewConfig:["display-widget-fave","display-widget-meta","display-widget-comment"],initialize:function(){if(this.is("rendering")||this.is("rendered"))return;this.setupSubviews().then(this.render.bind(this)).then(null,function(e){i.error("ERROR IN "+n,e.stack||e)})},activate:function(){var e=this,t;if(this.is("activating")||this.is("activated"))return;this.options.disableMeta&&this.get("container").addClass("no-meta"),this.get("container").on("click",function(e){var t=2;(e.ctrlKey||e.metaKey||e.which===t)&&e.stopPropagation()}),this.options.photoDeleteRights&&(this.options.photoDeleteRights.allPhotos?t=!0:this.options.photoDeleteRights.ownPhotos&&this.photo.getValue("isOwner")&&(t=!0),t&&(this.get("container").one(".ui-delete-button").addClass("enabled"),this.attachEvents({":delete":function(t){e.fire("deletePhoto",{photo:e.photo})}}))),this.activateSubviews(),this.fire("activated")},render:function(){this.buildContainer({paft:this.paft,photo:this.getPhotoJSON()}),this.resetStyles()},getPhotoJSON:function(){var e=this.photo.toJSON();return e.url+=this.options.context||"",e.current=this.assetManager.toJSON(),e},resize:function(e,t){this.assetManager.setSize(e,t),this.bleedWidth=this.frameWidth=this.assetManager.naturalWidth,this.bleedHeight=this.frameHeight=this.assetManager.naturalHeight,this.fitToSize(this.assetManager.width,this.assetManager.height),this.fire("resize",{width:e||null,height:t||null})},fitToSize:function(e,t){var n={};n.overflow="hidden",n.width=this.frameWidth=e,n.width+="px",n.height=this.frameHeight=t,n.height+="px",this.setStyles("displayMask",n)},hibernate:function(){var e;if(this.is("hibernating"))return;this.is("hibernating",!0),e=this.get("container"),this.assetManager&&this.assetManager.cancel(),this.ancestor=this.ancestor||e.ancestor(),this.ancestor&&this.ancestor.addClass("ui-state-hibernating")},wake:function(){var e;if(!this.is("hibernating"))return;this.is("hibernating",!1),e=this.get("container"),this.ancestor=this.ancestor||e.ancestor(),this.ancestor&&this.ancestor.removeClass("ui-state-hibernating"),this.assetManager.load()},remove:function(){var e=this.get("container");e.addClass("no-meta"),e.addClass("deleted")},destructor:function(){this._style=null,this._el=null,this.assetManager=null}}),e.namespace("Views")[n]=t},"@VERSION@",{requires:["flutil","flog","display-item","hermes-template-display-item-tile","display-item-tile-css"],optional:["display-widget-fave","display-widget-comment","display-widget-meta"],langBundles:["groups"]});
YUI.add("hermes-lang-groups",function(e,t){e.Intl.add("hermes/groups","en-US",{POST_THRESHOLD_EVER:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool."],POST_THRESHOLD_DAY:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool each day."],POST_THRESHOLD_MONTH:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool each month."],POST_THRESHOLD_WEEK:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool each year."],ACCEPTED_CONTENT_TYPES:["Accepted content types:"],ACCEPTED_SAFETY_LEVELS:["Accepted safety levels:"],PHOTOS:["Photos"],VIDEOS:["Videos"],IMAGES:["Images"],SCREENSHOTS:["Screenshots"],ART:["Art"],SAFE:["Safe"],MODERATE:["Moderate"],RESTRICTED:["Restricted"],SEE_ALL_DISCUSSIONS:["See all discussions"],DISCUSSION_TITLE:["Title"],DISCUSSION_AUTHOR:["Author"],DISCUSSION_REPLIES:["Replies"],DISCUSSION_LAST_POST:["Latest Post"],DISCUSSION_LAST_REPLIER:["Last Replier"],NO_DISCUSSIONS:["Be the first to start a group discussion!"],BE_THE_FIRST:["Be the first to add a photo to the group!"],BE_THE_FIRST_JOIN:["Help get this group started: click the join button above!"],BE_THE_FIRST_SIGN_IN:["Help get this group started: sign in and contribute photos!"],ADD_SOME_PHOTOS:["Add some photos"],NO_PHOTOS:["No photos in this group"],POOL_PREVIEW_HEADER:["Photo pool"],POOL_HEADER:["Group pool"],ADD_PHOTO:["Add photo"],VIEW_X_PHOTOS:[{type:"plural",valueName:"count",options:{one:"View ${#} photos",other:"View ${#} photos"}}],DISCUSSIONS:["Discussions"],ADD_TOPIC:["Add topic"],SEARCH_DISCUSSIONS:["Search discussions"],SEARCH_POOL:["Search pool"],ADD_A_TOPIC:["Add a topic"],TOP_CONTRIBUTORS:["Top Contributors"],CONTRIBUTORS:["Contributors"],CONTRIBUTORS_RANK:["Rank"],CONTRIBUTORS_LATEST_PHOTO:["Latest Photo"],CONTRIBUTORS_PHOTOS:["Photos"],CONTRIBUTORS_DISCUSSIONS:["Discussions"],CONTRIBUTORS_JOINED_GROUP:["Joined Group"],SEE_ALL_MEMBERS:["View all members"],TOTAL_DISCUSSIONS:[{type:"plural",valueName:"count",options:{one:"1 discussion in",other:"${#} discussions in"}}," ","${groupname}"],DISCUSSION_STICKY:["Sticky"],RANKING:["#","${count}"],BLAST_INVITED_MEMBER:["MEMBER"],BLAST_PENDING_MEMBER:["MEMBER"],BLAST_GROUP_MEMBER:["MEMBER"],BLAST_MODERATOR:["MODERATOR"],BLAST_ADMIN:["ADMIN"],SHARE:["Share"],EIGHTTEEN_PLUS_SIGNEDIN:["This group is 18+, do you want to enter?"],EIGHTEEN_PLUS_SIGNEDOUT:["This group is 18+. Sign in to view the group."],NO:["No"],YES:["Yes"],GROUP_POOL_LOADING_ERROR:["Error loading the group's pool photos"],GROUP_DISCUSSION_LOADING_ERROR:["Error loading the group's discussion list"],GROUP_TOP_CONTRIBUTORS_LOADING_ERROR:["Error loading the group's top contributors"],GROUP_DELETION_ERROR:["Something went wrong deleting the photo...please try again."],RETRY:["Retry"],ADDED_NOTIFICATION:['Success! Would you like to <a href="',"${url}",'">add something else</a>?'],NOT_ADDED_NOTIFICATION:['That\u2019s already in the group pool. <a href="',"${url}",'">Try something else?</a>'],PENDING_NOTIFICATION:['Your photo/video has been submitted the group. If approved by the group administrator, it will show up in the group pool. Would you like to <a href="',"${url}",'">add another</a>?'],DONE_PENDING_NOTIFICATION:["All done! There's nothing else to moderate."],DELETED_NOTIFICATION:["That item has been removed from the pool."],POOL_MEMBERS_ONLY:["This group pool is for members only."],DISCUSSION_MEMBERS_ONLY:["This group discussion is for members only."],REMOVE_PHOTO:["Remove this photo from the group pool?"],PENDING_COUNT_NOTIFICATION:['You have <a href="',"${url}",'">',{type:"plural",valueName:"pendingCount",options:{zero:"0 items",one:"${#} item",other:"${#} items"}}," pending</a>"],X_GROUPS:[{type:"plural",valueName:"count",options:{one:"${#} Group",other:"${#} Groups"}}],HAS_NONE:["Looks like you don't belong to any group, so there is a list of ones you might like below."],SIGNED_OUT:["Groups are a fabulous way to share content and conversation, either privately or with the world. Believe us when we say there's probably a group for everyone, but if you can't find one you like, feel free to start your own."],LAST_REPLY_TIME_AGO:['<a href="',"${replyurl}",'" data-track="groupDiscussionTopicLastReplyClick">',"${time}"," ago</a>"],MEMBERS_ONLY_POOL_JOIN:["Only members can see this group pool. Click the Join button above to, uh...join!"],MEMBERS_ONLY_POOL_SIGN_IN:["Only members can see this group pool. Sign in to join the group."],PRIVATE_GROUP:["You've reached a private group."],RETURN_HOME:["Return home"],DISCUSSIONS_DISABLED:["Discussions are disabled for this group."],GO_TO_GROUP_HOME:["Go to group home"],GROUP_JOIN_RULES_DIALOG_TITLE:["Group Rules"],GROUP_JOIN_RULES_DIALOG_MESSAGE:["If you agree to these rules, you can join the group."],GROUP_JOIN_RULES_DIALOG_ACCEPT:["I agree"],GROUP_JOIN_RULES_DIALOG_DECLINE:["No, thanks"],GROUP_JOIN_ERROR:["Something went wrong with joining the group."],GROUP_LEAVE_ERROR:["Something went wrong with leaving the group."],GROUPS:["Groups"],GROUPS_LIST_LOADING_ERROR:['There was an issue loading the groups.<br>Click <a class="retry">Reload</a> to try again.'],GROUPS_LIST_ERROR_HEADER:["Error loading groups"],CONTRIBUTORS_DISCUSSION_TOPICS:["Topics"],GROUPS_LIST_GROUPS:["Groups"],GROUPS_LIST_MEMBERS:["Members"],GROUPS_LIST_PHOTOS:["Photos"],GROUPS_LIST_TOPICS:["Topics"],GROUPS_LIST_LATEST:["Latest"],GROUPS_LIST_LATEST_DISCUSSION:["Latest Post"],GROUPS_LIST_LATEST_PHOTO:["Latest Photo"],GROUPS_LEAVE_WARNING_TITLE:["Leave ","${title}","?"],GROUPS_LEAVE_WARNING:['Do you really want to leave the group "',"${title}",'?"'],GROUPS_LEAVE_WARNING_LAST_MEMBER:['Do you really want to leave the group "',"${title}",'"? Because you are the last person in this group, the group will be deleted if you leave.'
],GROUPS_LEAVE_WARNING_LEAVE_BUTTON:["Leave this group"],GROUPS_LEAVE_WARNING_CANCEL_BUTTON:["Cancel"],EMPTY_BLAST:["There's no admin blast"],ADD_BLAST:["Why don't you add one"],REMOVING_BLAST:["Removing Blast..."],CREATE_BLAST:["Add Group Admin Blast"],BACK_TO_OVERVIEW:["Back to group overview"],GROUP_POOL:["Group pool"],NO_VISIBLE_PHOTOS:["${screenname}"," doesn't have any photos visible to you in the ","${groupTitle}"," pool."],UPDATE_BLAST_ERROR:["Could not update the group blast at this time"],DELETE_BLAST_ERROR:["Could not delete the group blast at this time"],LONG_BLAST_ERROR:[{type:"plural",valueName:"count",options:{one:"Group blast is 1 character, it must be less than 496 characters.",other:"Group blast is ${#} characters, it must be less than 496 characters."}}],GROUPS_LIST_BELONG_HEADER:["Groups you are a member of"],GROUPS_LIST_BELONG_MORE:["View all groups you are a member of"],PENDING:[{type:"plural",valueName:"count",options:{one:"1 pending",other:"${#} pending"}}],GROUPS_ADMIN:["Groups you administer"],GROUPS_MODERATED:["Groups you moderate"],GROUPS_BELONG:["Groups you are a member of"],GROUPS_FAVED:["Groups you faved"],VIEW_ALL_GROUPS_ADMIN:["View all groups you administer"],VIEW_ALL_GROUPS_MODERATED:["View all groups you moderate"],GROUP_DESCRIPTION:["Group Description"],GROUP_RULES:["Group Rules"],GROUP_ADDITIONAL_INFO:["Additional Info"]})},"@VERSION@",{requires:["intl"]});
YUI.add("display-collection",function(e){"use strict";var t,n=e.flutil;t=e.Base.create("DisplayCollection",e.FlickrView,[],{initializer:function(t){this.layout=null,this.payload=[],this.displayItemExtras=t.displayItemExtras||{},this.options=n.extend({displayItemCtr:e.Views["display-item-tile"]},t),this._dataEvents=[],t.paft&&(this.paft=t.paft)},initialize:function(){var t=this,n;return n=new e.FlickrPromise(function(e,n){t.once("rendered",e),t.render()}),n=n.then(null,function(e){console.error("DisplayCollection.render",e+e.stack)}),n},activate:function(){return this},appendPhotos:function(e,t){t||(t=this.options.displayItemCtr),Array.isArray(e)||(e=[e]),this.payload=this.payload.concat(e.map(function(e){return{displayItem:null,displayItemCtr:t,type:"PhotoModel",service:null,renderBatch:null,params:{photo:e}}}))},appendDisplayItems:function(e){Array.isArray(e)||(e=[e]),this.payload=this.payload.concat(e.map(function(e){return{displayItem:e,displayItemCtr:e.constructor,type:"DisplayItem",service:null,renderBatch:null,params:null}}))},appendCollection:function(e,t){var n=this,r,i,s;t||(t=this.options.displayItemCtr),r=function(e,t){t?n.payload=i(e).concat(n.payload):n.payload=n.payload.concat(i(e))},i=function(n){return n.map(function(n){return{displayItem:null,displayItemCtr:t,type:"CollectionPaginator",service:e,renderBatch:null,params:{photo:n}}})},this.detachDataEvents(),s=e.on("listValueChanged",function(e){e.prepended?r(e.prepended,!0):r(e.added||[]),n.render()}),n._dataEvents.push(s),r(e.getCurrentPageAsList())},removePhotos:function(e){var t=this,n;n=e.map(function(e){var n;return t.payload.some(function(t){return t.params&&t.params.photo===e?(n=t,!0):!1}),n}).filter(function(e){return!!e}),n.length&&n.forEach(function(e){e.displayItem.remove()})},createDisplayItem:function(e){var t,r,i=this;return e.displayItem?e.displayItem:(t=n.extend(this.displayItemExtras,e.params,{appContext:this.appContext}),r=e.displayItem=new e.displayItemCtr(t),this.displayItemExtras.photoDeleteRights&&this._dataEvents.push(r.on("deletePhoto",function(e){i.fire("deletePhoto",e)})),r)},render:function(){var e=this,t;this._batch||(this._batch=0),this._batch++,t=this.payload.reduce(function(t,n){if(n.renderBatch)return t;n.renderBatch=e._batch;var r=e.createDisplayItem(n);return t.push(r),t},[]),this.layout.append(t)},positionFromHistory:function(){console.warn("display-collection::positionFromHistory() is a no-op. Implement on a subclass if needed.")},next:function(){var e=this.payload.slice(-1)[0];if(!e||!e.service||!e.service.next)return;return e.service.next()},getId:function(){return"DC-"+this.name.toUpperCase()},detachDataEvents:function(){this._dataEvents.forEach(function(e){e.detach()}),this._dataEvents=[]},destructor:function(){this.detachDataEvents(),this._dataEvents=null,this.layout&&this.layout.destroy(),this.layout=null,this.payload.forEach(function(e){e.displayItem&&e.displayItem.destroy(),e.layout=e.params=null}),this.options=null}},{ATTRS:{container:{value:"",setter:function(e){var t=e||this.getContainer({viewName:n.unCamelCaseify(this.name)});return t}}}}),e.DisplayCollection=t},"@VERSION@",{requires:["flickr-view","flutil","display-item-tile"]});
