YUI.add("search-photos-route",function(e){function n(e){n.superclass.constructor.call(this,e)}var t=e.flutil;e.Routes[this.name]=n,e.extend(n,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(n){var r={},i,s=this,o=s.intlMessage({intlName:"search.FLICKR_SEARCH"}),u=": ",a,f,l;return this.appContext.flipper.isFlipped("search")?(r.apiParams=this.processRequest(n),r.id=e.SearchHelper.generateQueryString(r.apiParams)||e.guid(),r.apiParams.text?(a=r.apiParams.text,f=u+r.apiParams.text):r.apiParams.tags&&(f=u+r.apiParams.tags),l=t.unescape(f),i={perPage:e.SearchHelper.PREFETCH_PAGE_SIZE},this.appContext.getModel("search-photos-models",r,i).then(function(t){return e.Promise.resolve({view:"search-photos-page-view",params:{searchId:YUI.Env.isServer?t.id:t.id,searchTerm:a},title:t.getValue("emptyQuery")||!l?o:o+l,layout:"scrolling"})},function(t){return s.appContext.warn("search-photos-route",t.message),e.Promise.resolve({view:"search-photos-page-view",params:{searchTerm:a,apiFailed:!0},title:l?o+l:o})})):this.displayServerErrorOrClientRedirect(n,"Couldn't load search page.",e.url("/search/?"+e.QueryString.stringify(n.query)))},processRequest:function(t){var n={};return n=e.merge(t.query,e.SearchHelper.mapRouteParamsToAPI(t.params)),n=e.SearchHelper.mapClassicSearchToAPI(n,this.appContext),e.SearchHelper.addParamDefaults(n),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(n),n}}),e.mix(n.prototype,e.Localizable)},"@VERSION@",{requires:["flutil","flickr-route","flickr-promise","search-helper","querystring-stringify-simple","localizable","search-photos-models","url"],langBundles:["search"]});
